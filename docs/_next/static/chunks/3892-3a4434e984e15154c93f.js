"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3892],{82720:function(e,t,n){n.d(t,{U:function(){return l}});var r=n(67294),a=n(29163),i=n(18538),o=n(94184),s=n.n(o),c=n(85893);var l=r.memo((0,a.ZP)((function(e){var t=e.className,n=e.onClickUpFile,r=e.onClickUpFolder,a=e.disabled;return r?(0,c.jsx)(i.Z,{className:s()(t,{disabled:a}),pointing:"top",icon:null,basic:!0,text:"Upload",children:(0,c.jsxs)(i.Z.Menu,{children:[(0,c.jsx)(i.Z.Item,{text:"File",icon:(0,c.jsx)("span",{className:"icon cru-fo-file"}),onClick:n}),(0,c.jsx)(i.Z.Item,{text:"Folder",icon:(0,c.jsx)("span",{className:"icon cru-fo-folder"}),onClick:r})]})}):(0,c.jsx)("div",{className:s()("btn-upload",{disabled:a},t),onClick:n,children:"Upload"})})).withConfig({displayName:"BtnUpload",componentId:"sc-wp55x1-0"})(["&.btn-upload,&.ui.dropdown>.text.divider{padding:0 4.285714rem;font-family:OpenSans-Medium;font-size:2.571429rem;line-height:6.428571rem;cursor:pointer;border:2px solid #000000;box-sizing:border-box;border-radius:1.714286rem;}&.disabled{background:#EEEEEE;border:unset !important;color:#AAAAAA;cursor:not-allowed;}&.ui.dropdown{.cru-fo{font-size:1.3rem;margin-left:1.1rem;}.menu::after{display:none;}.menu{width:100%;background:#FFFFFF;box-shadow:0 0.57rem 1.43rem 0 rgba(0,0,0,0.1);border:1px solid #EEEEEE;border-radius:0.86rem;padding:0.57rem;.icon{margin-left:1.144286rem;margin-right:1.714286rem;}.item{padding:0.78rem 0.57rem !important;border-radius:0.57rem;font-size:1.285714rem;&:active{background-color:#EEEEEE;}}}}"]))},66028:function(e,t,n){n.d(t,{N:function(){return P}});var r=n(30266),a=n(809),i=n.n(a),o=n(6169),s=n(9669),c=n.n(s),l=n(93162),u=n(56755),p=n.n(u),d=n(96486),f=n.n(d),m=n(67294),h=n(1300),g=n(22090),v=n(65382),y=n(29163),b=n(12752),x=n(54040),w=n(65369),k=n(20478),j=n(81496),Z=n(59996),C=n(45129),_=n(56262),S=n(99056),I=n(57908),N=n(60954),E=n(85893),P=["https://crustipfs.live","https://crustipfs.art","https://crustipfs.info","https://web3files.world","https://web3files.live","https://storagefiles.site","https://storagefiles.space","https://crustipfs.tech"];function A(e,t,n){return"".concat(n,"/ipfs/").concat(e.Hash,"?filename=").concat(e.Name)}function F(e,t){return z.apply(this,arguments)}function z(){return(z=(0,r.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.Cn)(t.Hash,{name:t.Name,encrypted:t.Encrypted,gateway:t.UpEndpoint,fromAccount:n.account,fromWallet:n.wallet,from:n.nickName,isDir:!!t.items});case 2:return r=e.sent,(0,Z.H)({type:3,walletType:n.wallet,address:n.account,data:{cid:t.Hash,fileType:t.items?1:0,strategy:t.Encrypted?1:0,shareType:0}}),e.abrupt("return","".concat(window.location.origin,"/share?code=").concat(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return{expired_at:0,reported_replica_count:0,amount:0,file_size:0,prepaid:!1}}}t.Z=m.memo((0,y.ZP)((function(e){var t,n,a,s,u=e.file,d=e.className,y=e.uc,Z=e.onDelete,C=e.type,P="public"===(void 0===C?"public":C),z=(0,k.V)(),D=(0,m.useContext)(b.Il),T=D.api,H=D.alert,U=D.loading,M=(0,_.T)().endpoints,B=(0,j.z)().gateway,R=(0,m.useCallback)((0,r.Z)(i().mark((function e(){var t,n,r,a,o,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.Encrypted||0!==f().size(u.items)){e.next=29;break}if(e.prev=1,y.secret){e.next=4;break}return e.abrupt("return");case 4:return U.show(),t=A(u,0,B),e.next=8,c().get(t,{responseType:"arraybuffer"});case 8:return n=e.sent,console.info("res::",n),r=(new Date).getTime(),e.next=13,(0,x.n)(n.data,y.secret);case 13:if(a=e.sent,console.info("decrypt:",((new Date).getTime()-r)/1e3),a){e.next=17;break}throw"error";case 17:console.info("de:",a),o=new File([a],u.Name,{type:n.headers["content-type"]}),(0,l.saveAs)(o,u.Name),U.hide(),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),U.hide(),H.error("Decrypt error");case 27:e.next=31;break;case 29:s=A(u,0,B),window.open(s,"_blank");case 31:case"end":return e.stop()}}),e,null,[[1,23]])}))),[y,u,M,B]),W=(0,I.WY)(),$=function(){var e=(0,r.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F(u,W);case 3:t=e.sent,window.open(t,"_blank"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),H.error((0,S.az)(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,r.Z)(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F(u,W);case 3:t=e.sent,n=W.nickName?"Check out what '".concat(W.nickName,"' is sharing on Crust Files!"):"Check out what I am sharing on Crust Files!",r="https://twitter.com/intent/tweet?text=".concat(encodeURI(n),"&url=").concat(encodeURIComponent(t),"&hashtags=web3,ipfs,crustnetwork,metaverse,crustfiles"),window.open(r,"_blank"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),H.error((0,S.az)(e.t0));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),q=T&&(null===(t=T.query)||void 0===t?void 0:t.market)&&((0,o.m)(T.query.market.filesV2)?T.query.market.filesV2:T.query.market.files),G=T&&(null===(n=T.query)||void 0===n?void 0:n.market)&&T.query.market.files,V=!!q,Y=(0,w.W7)(q,[u.Hash]),J=(0,w.W7)(G,[u.Hash]),X=(0,w.W7)(null===T||void 0===T||null===(a=T.derive)||void 0===a||null===(s=a.chain)||void 0===s?void 0:s.bestNumber),K=X&&X.toNumber(),Q=(0,m.useMemo)((function(){var e={status:"Submitted"};if(J&&!J.isEmpty){var t=O(J),n=t.expired_at,r=t.reported_replica_count,a=t.amount,i=t.file_size,o=t.prepaid;e.expireTime=n,e.amount=a,e.startTime=n?n-216e3:0,e.fileSize=i,e.confirmedReplicas=r,e.prepaid=o,n&&n<K&&(e.status="Expired"),r<1&&(e.status="Submitted"),n&&n>K&&r>0&&(e.status="Success")}else if(Y&&!Y.isEmpty){var s=O(Y),c=s.expired_at,l=s.reported_replica_count,p=s.amount,d=s.file_size,f=s.prepaid;e.expireTime=c,e.amount=p,e.startTime=c?c-216e3:0,e.fileSize=d,e.confirmedReplicas=l,e.prepaid=f,c&&c<K&&(e.status="Expired"),l<1&&(e.status="Submitted"),c&&c>K&&l>0&&(e.status="Success")}else V&&(new Date).getTime()-u.PinTime>=72e5&&(e.status="Failed");return K||(e.status="Loading"),e}),[J,Y,K]);return(0,E.jsxs)(h.Z.Row,{className:d,children:[(0,E.jsxs)(h.Z.Cell,{className:"fileName",children:[(0,S.lS)(u.Name),u.items&&(0,E.jsx)("span",{className:"icon cru-fo-folder"}),u.Encrypted&&(0,E.jsx)(g.Z,{trigger:(0,E.jsx)("span",{className:"icon cru-fo-key"}),content:"Encrypted",position:"top center"})]}),(0,E.jsxs)(h.Z.Cell,{textAlign:"right",children:[(0,S.lS)(u.Hash),(0,E.jsx)(g.Z,{position:"top center",content:"Copy File CID",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-copy",onClick:function(){return z(u.Hash)},style:{marginLeft:"1.8rem"}})})]}),(0,E.jsx)(h.Z.Cell,{textAlign:"center",style:{textTransform:"uppercase"},children:p()(Number(u.Size),{round:2})}),(0,E.jsxs)(h.Z.Cell,{textAlign:"center",children:["Loading"===Q.status&&(0,E.jsx)(v.Z,{loading:!0,name:"spinner"}),"Submitted"===Q.status&&Q.status,"Expired"===Q.status&&Q.status,"Failed"===Q.status&&Q.status,"Success"===Q.status&&"".concat(Q.status," (").concat(Q.confirmedReplicas," Replicas)")]}),(0,E.jsxs)(h.Z.Cell,{textAlign:"center",children:[(0,E.jsx)(g.Z,{position:"top center",content:"Open",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-external-link",style:{marginLeft:"1rem"},onClick:R})}),(0,E.jsx)(g.Z,{position:"top center",content:"Delete",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-trash-2",style:{marginLeft:"1rem"},onClick:function(){Z(u)}})}),(0,E.jsx)(g.Z,{position:"top center",content:"IPFS Scan",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-search",style:{marginLeft:"1rem"},onClick:function(){window.open("https://ipfs-scan.io?cid=".concat(u.Hash),"_blank")}})})]}),P&&(0,E.jsx)(h.Z.Cell,{textAlign:"center",children:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(N.Z,{className:"item-share-btn",onClick:$,children:"Share"}),(0,E.jsx)(g.Z,{position:"top center",content:"Quick Tweet",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-twitter",onClick:L,style:{marginLeft:"0.5rem",top:"0.2rem"}})})]})})]})})).withConfig({displayName:"FileItem",componentId:"sc-3bbeav-0"})(["color:var(--secend-color) !important;.cru-fo,.icon{cursor:pointer;font-size:1.3rem;position:relative;top:0.3rem;}.fileName{.icon{margin-left:0.6rem;}}.item-share-btn{padding:5px 11px !important;border-radius:8px !important;}"]))},14589:function(e,t,n){n.d(t,{ZP:function(){return m}});var r=n(67294),a=n(1300),i=n(73716),o=n(65382),s=n(17082),c=n(96486),l=n.n(c);var u=n(66028),p=n(29163),d=n(11163),f=n(85893);var m=r.memo((0,p.ZP)((function(e){var t=e.className,n=e.pageCount,c=void 0===n?7:n,p=e.files,m=e.type,h=void 0===m?"public":m,g=e.onDeleteItem,v=(0,d.useRouter)(),y="public"===h,b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,r.useState)(1),a=n[0],i=n[1];return(0,r.useMemo)((function(){var n=l().chunk(e,t);return{totalPage:n.length,pageList:n[a-1]||[],setPage:i,page:a}}),[e,a])}((0,r.useMemo)((function(){return p.filter((function(e){return"public"===h?!e.Encrypted:e.Encrypted}))}),[p,h]),c),x=(0,s.MH)(),w=b.totalPage>1?2:5,k=y?w+1:w;return(0,f.jsxs)(a.Z,{basic:"very",className:t,children:[(0,f.jsx)(a.Z.Header,{className:"font-sans-semibold",children:(0,f.jsxs)(a.Z.Row,{children:[(0,f.jsx)(a.Z.HeaderCell,{children:"File Name"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"File CID"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"File Size"}),(0,f.jsx)(a.Z.HeaderCell,{width:"3",textAlign:"center",children:"Status"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"Action"}),y&&(0,f.jsx)(a.Z.HeaderCell,{width:"2"})]})}),(0,f.jsx)(a.Z.Body,{className:"font-sans-regular",children:b.pageList.map((function(e,t){return(0,f.jsx)(u.Z,{type:h,onDelete:g,uc:x,file:e},"files_item_".concat(t))}))}),(0,f.jsx)(a.Z.Footer,{children:(0,f.jsxs)(a.Z.Row,{children:[(0,f.jsx)(a.Z.HeaderCell,{colSpan:k,className:"btns",children:(0,f.jsxs)("div",{className:"files-tip",children:["The file list is locally cached. If you want to keep this list when switching to another device, please go to ",(0,f.jsx)("span",{onClick:function(){return v.push("/setting")},children:"Settings->User Data Management"})," to migrate your user data."]})}),b.totalPage>1&&(0,f.jsx)(a.Z.HeaderCell,{colSpan:"3",textAlign:"right",children:(0,f.jsx)(i.Z,{totalPages:b.totalPage,activePage:b.page,firstItem:null,lastItem:null,prevItem:{content:(0,f.jsx)(o.Z,{name:"angle left"}),icon:!0},nextItem:{content:(0,f.jsx)(o.Z,{name:"angle right"}),icon:!0},secondary:!0,onPageChange:function(e,t){var n=t.activePage;return b.setPage(n)}})})]})})]})})).withConfig({displayName:"FilesTable",componentId:"sc-dquu9o-0"})(["padding:1rem 2rem;width:100%;thead{font-size:1.29rem;font-weight:600;th:first-child{padding-left:0.57rem !important;}th{border-bottom:unset !important;}}tbody{color:var(--secend-color);tr,td{border-top:unset !important;}tr > td:first-child{padding-left:0.57rem !important;}tr:nth-child(2n - 1){background-color:#f8f8f8;td:first-child{overflow:hidden;border-top-left-radius:0.57rem;border-bottom-left-radius:0.57rem;}td:last-child{overflow:hidden;border-top-right-radius:0.57rem;border-bottom-right-radius:0.57rem;}}}tfoot{.btns > button{margin-right:1rem !important;}th{border-top:unset !important;}.btns{span{cursor:pointer;color:#808080;}}.btns > i{color:var(--secend-color);cursor:pointer;}.pagination > .item{color:var(--secend-color);padding:0.8rem 1rem !important;min-width:unset !important;border-radius:5rem !important;margin:unset;}.files-tip{font-size:13px;line-height:22px;color:#999999;padding-left:0.57rem;span{color:var(--primary-color);}}}"]))},46176:function(e,t,n){n.d(t,{R:function(){return x}});var r=n(80318),a=n(30266),i=n(809),o=n.n(i),s=n(94184),c=n.n(s),l=n(67294),u=n(73935),p=n(29163),d=n(65058),f=n(85893);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){return new Promise((function(n){e.file((function(e){e._webkitRelativePath="".concat(t,"/").concat(e.name),n(e)}))}))}function v(e,t){return new Promise((function(n){var r=[];e.readEntries(function(){var i=(0,a.Z)(o().mark((function a(i){var s,c,l;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.length){a.next=36;break}s=m(i),a.prev=3,s.s();case 5:if((c=s.n()).done){a.next=23;break}if(!(l=c.value).isFile){a.next=15;break}return a.t0=r,a.next=11,g(l,t);case 11:a.t1=a.sent,a.t0.push.call(a.t0,a.t1),a.next=21;break;case 15:if(!l.isDirectory){a.next=21;break}return a.t2=r,a.next=19,v(l.createReader(),"".concat(t,"/").concat(l.name));case 19:a.t3=a.sent,r=a.t2.concat.call(a.t2,a.t3);case 21:a.next=5;break;case 23:a.next=28;break;case 25:a.prev=25,a.t4=a.catch(3),s.e(a.t4);case 28:return a.prev=28,s.f(),a.finish(28);case 31:return a.t5=r,a.next=34,v(e,t);case 34:a.t6=a.sent,r=a.t5.concat.call(a.t5,a.t6);case 36:n(r);case 37:case"end":return a.stop()}}),a,null,[[3,25,28,31]])})));return function(e){return i.apply(this,arguments)}}())}))}function y(e){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)(o().mark((function e(t){var n,r,a,i,s,c,l,u,p,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.files.length){e.next=2;break}return e.abrupt("return",null);case 2:for(n=t.items,r={files:[]},a=1===n.length,i=[],s=0;s<n.length;s++)c=n[s],(l=c.webkitGetAsEntry())&&l.isDirectory?(a&&(r.dir=l.name),i.push({reader:l.createReader(),path:l.name})):l&&(a?r.file=c.getAsFile():r.files.push(c.getAsFile()));u=0,p=i;case 8:if(!(u<p.length)){e.next=17;break}return d=p[u],e.next=12,v(d.reader,d.path);case 12:f=e.sent,r.files=r.files.concat(f);case 14:u++,e.next=8;break;case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=l.memo((0,p.ZP)((function(e){var t=e.className,n=(0,d.O)(),i=(0,r.Z)(n,2),s=i[0],p=i[1],m=(0,l.useState)(null),h=m[0],g=m[1],v=function(){var t=(0,a.Z)(o().mark((function t(n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,y(n.dataTransfer);case 3:r=t.sent,console.info("fielInfo:",r),p(!1),r&&e.onDrop&&e.onDrop(r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,l.useEffect)((function(){var e=document.getElementById("__next");g(e)}),[]),(0,l.useEffect)((function(){if(h){var e=function(e){e.preventDefault(),p(!0)},t=function(e){"_drap_drop_frame"===e.target.id&&p(!1)};return h.addEventListener("dragenter",e),h.addEventListener("dragleave",t),function(){var n=document.getElementById("_drap_drop_frame");n&&h.removeChild(n),h.removeEventListener("dragenter",e),h.removeEventListener("dragleave",t)}}}),[h]),h?u.createPortal((0,f.jsx)("div",{id:"_drap_drop_frame",onDrop:v,onDragOver:function(e){return e.preventDefault()},className:c()(t,{show:s}),children:"Upload files to this directory"}),h):null})).withConfig({displayName:"OnDrapDropFrame",componentId:"sc-oxlf0c-0"})(["position:fixed;width:100vw;height:100vh;z-index:9999999;left:0;top:0;background:rgba(255,255,255,0.7);border:3px dashed #cccccc;box-sizing:border-box;display:none;align-items:center;justify-content:center;font-weight:600;font-size:36px;&.show{display:flex;}"]))},48055:function(e,t,n){n.d(t,{Z:function(){return Y}});var r=n(80318),a=n(96486),i=n.n(a),o=n(67294),s=n(25443),c=n(345),l=n(73626),u=n(28258),p=n(37838),d=n(29163),f=n(65058),m=n(59996),h=n(30266),g=n(68216),v=n(92809),y=n(809),b=n.n(y),x=n(35391),w=n(2593),k=n(46441),j=JSON.parse('{"name":"StorageOrder","methods":[{"name":"create","args":[],"returns":{"type":"void"}},{"name":"bootstrap","args":[{"type":"pay","name":"seed"},{"type":"uint64","name":"base_price"},{"type":"uint64","name":"byte_price"},{"type":"uint64","name":"size_limit"},{"type":"uint64","name":"service_rate"},{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"set_base_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_byte_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_size_limit","args":[{"type":"uint64","name":"size"}],"returns":{"type":"void"}},{"name":"set_service_rate","args":[{"type":"uint64","name":"rate"}],"returns":{"type":"void"}},{"name":"set_algo_cru_price","args":[{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"add_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"remove_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"get_random_order_node","args":[],"returns":{"type":"address"}},{"name":"get_price","args":[{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"uint64"}},{"name":"place_order","args":[{"type":"pay","name":"seed"},{"type":"account","name":"merchant"},{"type":"string","name":"cid"},{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"void"}}],"networks":{},"desc":"This is storage order contract used to place order"}'),Z=n(96598),C=n(57908),_=n(48764).Buffer;function S(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N=new x.default.Algodv2(Z.s3.token,Z.s3.algodUrl),E=function e(){(0,g.Z)(this,e),(0,v.Z)(this,"base_price",w.O$.from(0)),(0,v.Z)(this,"byte_price",w.O$.from(0)),(0,v.Z)(this,"service_rate",w.O$.from(0)),(0,v.Z)(this,"algo_price",w.O$.from(0)),(0,v.Z)(this,"cru_price",w.O$.from(0))};function P(e,t){return A.apply(this,arguments)}function A(){return(A=(0,h.Z)(b().mark((function e(t,n){var r,a,i,o,s,c,l,u;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.getApplicationByID(Z.s3.applicationId).do();case 2:r=e.sent,a=new E,i=new Set(Object.keys(a)),o=S(r.params["global-state"]);try{for(o.s();!(s=o.n()).done;)c=s.value,l=_.from(c.key,"base64").toString(),i.has(l)&&(a[l]=w.O$.from(c.value.uint))}catch(p){o.e(p)}finally{o.f()}return u=a.base_price.add(a.byte_price.mul(t).div(1024).div(1024)).mul(a.service_rate.add(100)).div(100).mul(a.cru_price).div(a.algo_price).div(w.O$.from("1".concat("0".repeat(12)))),e.abrupt("return",n?u.mul(200):u);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n,r){return z.apply(this,arguments)}function z(){return(z=(0,h.Z)(b().mark((function e(t,n,r,a){var i,o,s,c,l,u,p,d,f,m,h,g,v;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=O(t.algorand.wallet),e.next=3,N.getTransactionParams().do();case 3:return o=e.sent,s=new x.default.ABIContract(j),e.next=7,P(r,a);case 7:return c=e.sent,e.next=10,D();case 10:return l=e.sent,u=x.default.makePaymentTxnWithSuggestedParamsFromObject({from:t.algorand.account,to:Z.s3.applicationAddress,amount:BigInt(c.toString()),suggestedParams:o}),p=new x.default.AtomicTransactionComposer,d={txn:u,signer:i},(f=[]).push({appIndex:Z.s3.applicationId,name:x.default.decodeAddress(l).publicKey},{appIndex:Z.s3.applicationId,name:new Uint8Array(_.from("nodes"))}),p.addMethodCall({appID:Z.s3.applicationId,method:s.getMethodByName("place_order"),methodArgs:[d,l,n,r,a],sender:t.algorand.account,signer:i,boxes:f,suggestedParams:o}),e.next=19,p.execute(N,4);case 19:m=e.sent,h=S(m.methodResults),e.prev=21,h.s();case 23:if((g=h.n()).done){e.next=28;break}return v=g.value,e.abrupt("return",v.txID);case 26:e.next=23;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(21),h.e(e.t0);case 33:return e.prev=33,h.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[21,30,33,36]])})))).apply(this,arguments)}function O(e){return function(){var t=(0,h.Z)(b().mark((function t(n,r){var a,o;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i().map(r,(function(e){return{txn:n[e]}})),t.next=3,e.signTransaction([a]);case 3:return o=t.sent,t.abrupt("return",Promise.resolve(o));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}function D(){return T.apply(this,arguments)}function T(){return(T=(0,h.Z)(b().mark((function e(){var t,n,r,a,i,o,s,c,l,u,p,d,f,m,h,g,v;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="node_num",e.next=3,N.getApplicationByID(Z.s3.applicationId).do();case 3:n=e.sent,r=x.default.ABIType.from("string"),a=r.encode(t).slice(-t.length),i=_.from(a).toString("base64"),o=0,s=S(n.params["global-state"]),e.prev=9,s.s();case 11:if((c=s.n()).done){e.next=18;break}if((l=c.value).key!==i){e.next=16;break}return o=l.value.uint,e.abrupt("break",18);case 16:e.next=11;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),s.e(e.t0);case 23:return e.prev=23,s.f(),e.finish(23);case 26:if(0!==o){e.next=28;break}throw new Error("No merchant node for algorand user to order.");case 28:return u=Math.floor(Math.random()*o),p="nodes",d=r.encode(p).slice(-p.length),e.next=33,N.getApplicationBoxByName(Z.s3.applicationId,d).do();case 33:return f=e.sent,m=x.default.ABIType.from("uint8[32][30]"),h=m.decode(f.value),g=h[u],v=new Uint8Array(g.map((function(e){return Number(e)}))),e.abrupt("return",x.default.encodeAddress(v));case 39:case"end":return e.stop()}}),e,null,[[9,20,23,26]])})))).apply(this,arguments)}var H=n(56262),U=n(56371);function M(){var e=(0,C.WY)();return(0,o.useMemo)((function(){var t,n;if(!(null===(t=e.useWallet)||void 0===t||!t.getProvider))return null===(n=e.useWallet)||void 0===n?void 0:n.getProvider()}),[e])}var B=n(96519);function R(e,t){var n=function(){var e,t=M();return null===t||void 0===t||null===(e=t.network)||void 0===e?void 0:e.chainId}(),r=function(){var e=M();return(0,o.useMemo)((function(){if(e){var t=Z.XH[e.network.chainId];if(t)return B.lV.getContract(t,Z.gE,e.getSigner())}}),[e])}(),i=(0,C.WY)().wallet,s=(0,o.useState)("-"),c=s[0],l=s[1],u=(0,o.useRef)("");(0,o.useEffect)((function(){var o=(0,a.uniqueId)();return u.current=o,l("-"),"metamask"===i&&r&&r.getPrice(w.O$.from(e),t).then((function(e){u.current==o&&l((0,U.formatEther)(e)+" "+(Z.p$[n]||"ETH"))})).catch(console.error),function(){}}),[e,t,n,i]);var p=function(){var n=(0,h.Z)(b().mark((function n(a){var i,o,s,c,l,u,p,d;return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=w.O$.from(e),n.next=3,r.getPrice(o,t);case 3:return s=n.sent,c=[a,o,t],n.next=7,(i=r.estimateGas).placeOrder.apply(i,c.concat([{value:s}]));case 7:return l=n.sent,n.next=10,r.placeOrder.apply(r,c.concat([{value:s,gasLimit:l.mul(120).div(100)}]));case 10:return u=n.sent,n.next=13,u.wait();case 13:return p=n.sent,d=p.transactionHash,n.abrupt("return",d);case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{pin:r?p:void 0,chainId:n,fee:c}}var W=n(10416),$=n(60954),L=n(31772),q=n(85893),G=d.ZP.div.withConfig({displayName:"UploadModal__Contribute",componentId:"sc-1ozqz35-0"})(["cursor:pointer;height:40px;line-height:40px;color:var(--primary-color);text-align:center;"]),V=function(){};var Y=o.memo((0,d.ZP)((function(e){var t=(0,C.WY)().wallet,n=e.className,d=e.uc,g=e.file,v=e.onClose,y=void 0===v?V:v,x=e.onSuccess,w=void 0===x?V:x,j=e.user,_=e.type,S=e.isPremium,I="vault"===_,N=(0,s.$)().t,E=(0,H.T)(),A=E.endpoint,z=E.endpoints,O=E.onChangeEndpoint,D=(0,H.q)(),T=D.onChangePinner,U=D.pinner,M=D.pins,B=(0,f.O)(!0),Y=(0,r.Z)(B,2),J=Y[0],X=Y[1],K=(0,o.useMemo)((function(){var e=g.file?g.file.size:g.files?i().sumBy(g.files,"size")+1024:0;return 0===e?e:e+Math.round(.2*e)}),[g]),Q="algorand"===t?function(e,t){var n=(0,C.WY)().wallet,r=(0,C.WY)(),i=(0,o.useState)("-"),s=i[0],c=i[1],l=(0,o.useRef)("");return(0,o.useEffect)((function(){var r=(0,a.uniqueId)();return l.current=r,c("-"),"algorand"===n&&P(BigInt(e),t).then((function(e){l.current==r&&c(k.formatUnits(e.toString(),6)+" "+(Z.p$[Z.s3.chainId]||"ETH"))})).catch(console.error),function(){}}),[e,t,n]),{pin:function(){var n=(0,h.Z)(b().mark((function n(a){return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,F(r,a,BigInt(e),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),chainId:Z.s3.chainId,fee:s}}(K,J):R(K,J),ee=Q.pin,te=Q.fee,ne=Q.chainId,re=!!ee,ae=I&&!!d.secret,ie=(0,f.O)(),oe=(0,r.Z)(ie,2),se=(oe[0],oe[1],(0,W.V)(j,{isEncrypt:!!ae,secret:d.secret,file:g,isPremium:S,endpoint:A,pinner:U,pin:ee,chainId:ne})),ce=se.error,le=se.cancelUp,ue=se.upState,pe=se.upload,de=se.isBusy,fe=se.fileSizeError,me=(0,o.useCallback)((function(){le&&le.cancel(),y()}),[le,y]);console.log("filesize error",fe),console.log("isVault error",I),console.log("uc.secret",d.secret),console.log("user.account",j.account),console.log("!user.sign",!j.sign);var he=fe||I&&!d.secret||!j.account||!j.sign;return(0,q.jsxs)(c.Z,{closeIcon:(0,q.jsx)("span",{className:"close icon cru-fo-x"}),onClose:me,open:!0,size:"large",className:n,children:[(0,q.jsx)(c.Z.Header,{className:"font-sans-semisold",children:N(g.dir?"Upload Folder":"Upload File")}),(0,q.jsxs)(c.Z.Content,{children:[(0,q.jsxs)(l.Z.Group,{children:[(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:g.dir?"Folder":"File"}),(0,q.jsx)(l.Z.Description,{content:g.dir?"".concat(g.dir," (").concat(g.files.length," files)"):"".concat(g.file.name," (").concat(g.file.size," bytes)")})]})}),(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsx)(L.Z,{fluid:!0,selection:!0,className:"clear-border",help:N("File streaming and wallet authentication will be processed by the chosen gateway."),disabled:de,label:N("Select a free Web3 IPFS Gateway"),onChange:O,options:z,defaultGroup:A.group,defaultValue:A.value,footer:(0,q.jsx)(G,{onClick:function(){return window.open("https://wiki.crust.network/docs/en/buildIPFSWeb3AuthGW","_blank")},children:"Contribute IPFS W3Auth Gateway"})})}),re?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(l.Z,{fluid:!0,className:"encryption",children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:"Permanent storage"}),(0,q.jsx)(l.Z.Description,{style:{color:J?"transparent":void 0},content:J?"-":"Non-permanent storage, the guarantee period for the file is only 6 months."}),(0,q.jsx)(u.Z,{toggle:!0,defaultChecked:J,onChange:function(e,t){var n=t.checked;return X(n)}})]})}),(0,q.jsxs)("div",{style:{padding:"0 20px"},children:["Storage fee: ",te]})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsx)(L.Z,{fluid:!0,selection:!0,className:"clear-border",help:N("Your file will be pinned to IPFS for long-term storage."),disabled:0===M.length,label:N("Select a Web3 IPFS Pinner"),onChange:T,options:M,defaultValue:U.value,footer:(0,q.jsx)(G,{onClick:function(){return window.open("https://wiki.crust.network/docs/en/buildIPFSW3AuthPin","_blank")},children:"Contribute IPFS W3Auth Pinner"})})}),(0,q.jsx)(l.Z,{fluid:!0,className:"encryption",children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:"File Encryption"}),d.secret?(0,q.jsx)(l.Z.Description,{content:ae?"Yes":"File encryption is disabled in Public Mode."}):(0,q.jsx)(l.Z.Description,{content:"Please go to the 'Setting' page and set encryption key before activating this function."}),(0,q.jsx)(u.Z,{toggle:!0,defaultChecked:ae,disabled:!0})]})})]})]}),ce&&(0,q.jsx)("div",{style:{color:"orangered",padding:"1rem",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:ce})]}),(0,q.jsx)(c.Z.Actions,{children:(0,q.jsxs)("div",{className:"uploading",children:[ue.up&&(0,q.jsx)(p.Z,{value:ue.progress,total:100,active:!0,color:"orange"}),ue.up&&(0,q.jsx)($.Z,{onClick:me,children:N("Cancel")}),!ue.up&&(0,q.jsx)($.Z,{fluid:!0,onClick:function(){he||pe().then((function(e){var t=(0,r.Z)(e,1)[0];return w(t),(0,m.H)({type:2,walletType:j.wallet,address:j.account,data:{cid:t.Hash,fileType:i().size(t.items)?1:0,strategy:t.Encrypted?1:0}})})).catch(console.error)},disabled:he,children:N("Confirm")})]})})]})})).withConfig({displayName:"UploadModal",componentId:"sc-1ozqz35-1"})(['width:51.43rem !important;.header:nth-child(2){height:3.93rem;font-size:1.3rem !important;padding:0 1.14rem !important;font-weight:600 !important;line-height:3.93rem !important;}.close.icon{top:0.5rem;right:0.6rem;color:#666666;}.content{padding:1rem !important;}.ui.cards > .card{margin:0.5rem !important;.content > .header{font-size:1rem;font-weight:unset !important;color:var(--main-color);font-weight:600;font-family:OpenSans-SemiBold;}.content > .description{font-size:1rem;color:#999999;font-family:OpenSans-Regular;}}.ui.cards > .card:first-child{margin-top:1rem !important;}.toggle-options{cursor:pointer;font-size:10px;color:#999999;line-height:14px;margin-top:8px;margin-left:1.51rem;.cru-fo{font-size:14px;position:relative;top:2px;margin-left:6px;}}.actions{height:4.8rem;padding:0.5rem 1rem 0 1rem !important;border-top:unset !important;background:unset !important;.button{margin-left:unset !important;}}.uploading{height:4rem;display:flex;align-items:center;.progress{margin:0 1rem 0 0 !important;vertical-align:baseline;background:unset !important;border:1px solid orange;flex:1;.bar{min-width:unset !important;height:2.5rem;}}}.card.encryption{position:relative;.toggle{position:absolute;top:calc(50% - 0.75rem);right:1rem;input[type="radio"]:checked + label:before{background-color:#2ed158 !important;}}}']))},81496:function(e,t,n){n.d(t,{z:function(){return d}});var r=n(92809),a=n(80318),i=n(67294),o=n(58971),s=n.n(o),c=n(34111);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=[{text:"https://ipfs.io",value:"https://ipfs.io"},{text:"https://crustgateway.online",value:"https://crustgateway.online"},{text:"https://gw.w3ipfs.org.cn",value:"https://gw.w3ipfs.org.cn"}];function d(){var e=(0,i.useState)({gateway:"https://ipfs.io"}),t=e[0],n=e[1],r=(0,i.useState)(p),o=r[0],l=r[1];(0,i.useEffect)((function(){var e=s().get("downloadgateway");e&&n(e),s().get("allDownloadGateways"),o&&l(o)}),[]);var d=(0,i.useCallback)((function(e){var t={gateway:e};n(t),s().set("downloadgateway",t)}),[]),f=(0,c.X)((function(){return fetch("https://gist.githubusercontent.com/XueMoMo/2cfc982ce6aefb85e09313b714a029bd/raw/CrustFilesDownloadGateway.json").then((function(e){return e.json()})).then((function(e){return e.map((function(e){return{text:e,value:e}}))}))}),[]),m=(0,a.Z)(f,1)[0];return(0,i.useEffect)((function(){m&&m.length&&(s().set("allDownloadGateways",m),l(m))}),[m]),(0,i.useMemo)((function(){return u(u({},t),{},{set:d,allDownloadGateways:o})}),[t,d,o])}},55867:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(80318),a=n(67294),i=n(25443),o=n(12752);function s(){var e=(0,i.$)().t,t=(0,a.useContext)(o.Il).alert,n=(0,a.useState)(void 0),s=n[0],c=n[1],l=(0,a.useRef)(null),u=(0,a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l.current&&(l.current.webkitdirectory=e,l.current.multiple=e,l.current.click())}),[l]),p=(0,a.useCallback)((function(){return u(!1)}),[u]),d=(0,a.useCallback)((function(){return u(!0)}),[u]),f=(0,a.useCallback)((function(n){var a=n.target.files;if(a)if(a.length>2e3)t.alert({title:e("Upload"),msg:e("Please do not upload more than 2000 files"),type:"error"});else if(0!==a.length){if(n.target.webkitdirectory){if(a.length>=1){for(var i=[],o=0;o<a.length;o++)i.push(a[o]);console.info(i);var s=i[0].webkitRelativePath.split("/"),l=(0,r.Z)(s,1)[0];c({files:i,dir:l})}}else c({file:a[0]});n.target.value=""}else t.alert({title:e("Upload"),msg:e("Please select non-empty folder"),type:"error"})}),[c,t,e]);return(0,a.useMemo)((function(){return{file:s,setFile:c,inputRef:l,_onClickUpFile:p,_onClickUpFolder:d,_onInputFile:f}}),[s,l,p,d,f])}},2125:function(e,t,n){n.d(t,{D:function(){return c}});var r=n(67294),a=n(96486),i=n.n(a),o=n(56755),s=n.n(o);function c(e){return(0,r.useMemo)((function(){var t=e.files.length,n=i().groupBy(e.files,(function(e){return e.Encrypted?"valut":"public"}));return n.public||(n.public=[]),n.valut||(n.valut=[]),{count:t,publicCount:i().size(n.public),valutCount:i().size(n.valut),publicSize:s()(i().sumBy(n.public,(function(e){return i().toNumber(e.Size)}))).toUpperCase(),valutSize:s()(i().sumBy(n.valut,(function(e){return i().toNumber(e.Size)}))).toUpperCase()}}),[e.files])}}}]);