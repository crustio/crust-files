"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{8553:(e,t,r)=>{r.d(t,{Kv:()=>u,Rg:()=>c,_j:()=>d});var n=r(3821),i=r(74638),a=r.n(i),o=r(87998),s=r(80351);let l=new s.y(8),c=e=>new Promise((t,r)=>{let n=new FileReader;n.onload=()=>{n.result&&t(n.result)},n.onerror=r,n.readAsArrayBuffer(e)});function d(e){try{let t=e&&e.trim();if(t){let e=t.split(" ");if(1===e.length&&e[0]){let t=e[0],r=window.atob(t),n=l.phraseFromSecret(r);if(n&&n.split(" ").length>=4)return{secret:t,seeds:n}}else if(e.length>=4){let e=l.secretFromPhrase(t);if(e&&e.split("-").length>=4)return{secret:window.btoa(e),seeds:t}}}return null}catch(e){return null}}function u(){let[e,t]=(0,n.useState)({}),[r,i]=(0,o.e)();(0,n.useEffect)(()=>{let e=a().get("user:crypto");e&&t(e),i(!0)},[]);let l=(0,n.useCallback)(e=>{t(e),a().set("user:crypto",e)},[]),c=(0,n.useCallback)(async()=>{let{secret:e,mnemonics:t}=new s.y(8).genMnemonics(),r={secret:window.btoa(e),seeds:t};return l(r),r},[]);return(0,n.useMemo)(()=>({...e,generate:c,set:l,init:r}),[e,l,r,c])}},10664:(e,t,r)=>{r.d(t,{M:()=>l});var n=r(3821),i=r(74638),a=r.n(i),o=r(12034);let s=[{text:"https://ipfs.io",value:"https://ipfs.io"},{text:"https://crustgateway.online",value:"https://crustgateway.online"},{text:"https://gw.w3ipfs.org.cn",value:"https://gw.w3ipfs.org.cn"}];function l(){let[e,t]=(0,n.useState)({gateway:"https://ipfs.io"}),[r,i]=(0,n.useState)(s);(0,n.useEffect)(()=>{let e=a().get("downloadgateway");e&&t(e),a().get("allDownloadGateways"),r&&i(r)},[]);let l=(0,n.useCallback)(e=>{let r={gateway:e};t(r),a().set("downloadgateway",r)},[]),[c]=(0,o.O)(()=>fetch("https://gist.githubusercontent.com/XueMoMo/2cfc982ce6aefb85e09313b714a029bd/raw/CrustFilesDownloadGateway.json").then(e=>e.json()).then(e=>e.map(e=>({text:e,value:e}))),[]);return(0,n.useEffect)(()=>{c&&c.length&&(a().set("allDownloadGateways",c),i(c))},[c]),(0,n.useMemo)(()=>({...e,set:l,allDownloadGateways:r}),[e,l,r])}},20692:(e,t,r)=>{r.d(t,{A:()=>z,i:()=>_});var n=r(29913),i=r(35648),a=r(91933),o=r.n(a),s=r(18077),l=r(36450),c=r.n(l),d=r(55982),u=r.n(d),p=r(3821),m=r(93572),f=r(59544),g=r(17468),h=r(23472),y=r(87080),w=r(35969),b=r(59061),v=r(73112),x=r(10664),A=r(87545),j=r(34133),k=r(41207),C=r(6271),I=r(35295),S=r(64881);let _=["https://crustipfs.live","https://crustipfs.art","https://crustipfs.info","https://web3files.world","https://web3files.live","https://storagefiles.site","https://storagefiles.space","https://crustipfs.tech"];function E(e,t,r){return"".concat(r,"/ipfs/").concat(e.Hash,"?filename=").concat(e.Name)}async function N(e,t){var r;let n=await (0,j.Y)(e.Hash,{name:e.Name,encrypted:null!=(r=e.Encrypted)&&r,gateway:e.UpEndpoint,fromAccount:t.account,fromWallet:t.wallet,from:t.nickName,isDir:!!e.items});return(0,A.z)({type:3,walletType:t.wallet,address:t.account,data:{cid:e.Hash,fileType:+!!e.items,strategy:+!!e.Encrypted,shareType:0}}),"".concat(window.location.origin,"/share?code=").concat(n)}function P(e){try{return JSON.parse(JSON.stringify(e))}catch(e){return{expired_at:0,reported_replica_count:0,amount:0,file_size:0,prepaid:!1}}}let z=p.memo((0,h.Ay)(function(e){var t,r,a,l;let{file:d,className:h,uc:A,onDelete:j,type:_="public"}=e,z=(0,v.i)(),{api:F,alert:T,loading:M}=(0,p.useContext)(y.BR),{endpoints:B}=(0,k.e)(),{gateway:D}=(0,x.M)(),R=(0,p.useCallback)(async()=>{if(d.Encrypted&&0===u().size(d.items))try{if(!A.secret)return;M.show();let e=E(d,B,D),t=await o().get(e,{responseType:"arraybuffer"});console.info("res::",t);let r=new Date().getTime(),n=await (0,w.I)(t.data,A.secret);if(console.info("decrypt:",(new Date().getTime()-r)/1e3),!n)throw"error";console.info("de:",n);let i=new File([n],d.Name,{type:t.headers["content-type"]});(0,s.saveAs)(i,d.Name),M.hide()}catch(e){M.hide(),T.error("Decrypt error")}else{let e=E(d,B,D);window.open(e,"_blank")}},[A,d,B,D]),H=(0,I.ZR)(),U=async()=>{try{let e=await N(d,H);window.open(e,"_blank")}catch(e){T.error((0,C.Yf)(e))}},L=async()=>{try{let e=await N(d,H),t=H.nickName?"Check out what '".concat(H.nickName,"' is sharing on Crust Files!"):"Check out what I am sharing on Crust Files!",r="https://twitter.com/intent/tweet?text=".concat(encodeURI(t),"&url=").concat(encodeURIComponent(e),"&hashtags=web3,ipfs,crustnetwork,metaverse,crustfiles");window.open(r,"_blank")}catch(e){T.error((0,C.Yf)(e))}},G=F&&(null==(t=F.query)?void 0:t.market)&&((0,i.T)(F.query.market.filesV2)?F.query.market.filesV2:F.query.market.files),O=F&&(null==(r=F.query)?void 0:r.market)&&F.query.market.files,W=!!G,K=(0,b.Gc)(G,[d.Hash]),V=(0,b.Gc)(O,[d.Hash]),q=(0,b.Gc)(null==F||null==(l=F.derive)||null==(a=l.chain)?void 0:a.bestNumber),J=q&&q.toNumber(),Z=(0,p.useMemo)(()=>{let e={status:"Submitted"};if(V&&!V.isEmpty){let{expired_at:t,reported_replica_count:r,amount:n,file_size:i,prepaid:a}=P(V);e.expireTime=t,e.amount=n,e.startTime=t?t-216e3:0,e.fileSize=i,e.confirmedReplicas=r,e.prepaid=a,t&&J&&t<J&&(e.status="Expired"),r<1&&(e.status="Submitted"),t&&J&&t>J&&r>0&&(e.status="Success")}else if(K&&!K.isEmpty){let{expired_at:t,reported_replica_count:r,amount:n,file_size:i,prepaid:a}=P(K);e.expireTime=t,e.amount=n,e.startTime=t?t-216e3:0,e.fileSize=i,e.confirmedReplicas=r,e.prepaid=a,t&&J&&t<J&&(e.status="Expired"),r<1&&(e.status="Submitted"),t&&J&&t>J&&r>0&&(e.status="Success")}else W&&new Date().getTime()-d.PinTime>=72e5&&(e.status="Failed");return J||(e.status="Loading"),e},[V,K,J]);return(0,n.jsxs)(m.A.Row,{className:h,children:[(0,n.jsxs)(m.A.Cell,{className:"fileName",children:[(0,C.wh)(d.Name),d.items&&(0,n.jsx)("span",{className:"icon cru-fo-folder"}),d.Encrypted&&(0,n.jsx)(f.A,{trigger:(0,n.jsx)("span",{className:"icon cru-fo-key"}),content:"Encrypted",position:"top center"})]}),(0,n.jsxs)(m.A.Cell,{textAlign:"center",children:[(0,C.wh)(d.Hash),(0,n.jsx)(f.A,{position:"top center",content:"Copy File CID",trigger:(0,n.jsx)("span",{className:"cru-fo cru-fo-copy",onClick:()=>z(d.Hash),style:{marginLeft:"1.8rem"}})})]}),(0,n.jsx)(m.A.Cell,{textAlign:"center",style:{textTransform:"uppercase"},children:c()(Number(d.Size),{round:2})}),(0,n.jsxs)(m.A.Cell,{textAlign:"center",style:{whiteSpace:"nowrap"},children:["Loading"===Z.status&&(0,n.jsx)(g.A,{loading:!0,name:"spinner"}),"Submitted"===Z.status&&Z.status,"Expired"===Z.status&&Z.status,"Failed"===Z.status&&Z.status,"Success"===Z.status&&"".concat(Z.status," (").concat(Z.confirmedReplicas," Replicas)")]}),(0,n.jsxs)(m.A.Cell,{textAlign:"center",children:[(0,n.jsx)(f.A,{position:"top center",content:"Open",trigger:(0,n.jsx)("span",{className:"cru-fo cru-fo-external-link",style:{marginLeft:"1rem"},onClick:R})}),(0,n.jsx)(f.A,{position:"top center",content:"Delete",trigger:(0,n.jsx)("span",{className:"cru-fo cru-fo-trash-2",style:{marginLeft:"1rem"},onClick:()=>{j(d)}})}),(0,n.jsx)(f.A,{position:"top center",content:"IPFS Scan",trigger:(0,n.jsx)("span",{className:"cru-fo cru-fo-search",style:{marginLeft:"1rem"},onClick:()=>{window.open("https://ipfs-scan.io?cid=".concat(d.Hash),"_blank")}})})]}),"public"===_&&(0,n.jsx)(m.A.Cell,{textAlign:"center",singleLine:!0,children:(0,n.jsxs)("div",{className:"btns",children:[(0,n.jsx)(S.A,{className:"item-share-btn",onClick:U,children:"Share"}),(0,n.jsx)(f.A,{position:"top center",content:"Quick Tweet",trigger:(0,n.jsx)("span",{className:"cru-fo cru-fo-twitter",onClick:L,style:{top:0}})})]})})]})}).withConfig({componentId:"sc-39df1619-0"})(["color:var(--secend-color) !important;.cru-fo,.icon{cursor:pointer;font-size:1.3rem;position:relative;top:0.3rem;}.fileName{.icon{margin-left:0.6rem;}}.item-share-btn{padding:5px 11px !important;border-radius:8px !important;}td.center{text-align:center;}td.right{text-align:right;}.btns{display:flex;align-items:center;justify-content:center;gap:0.5rem;}"]))},27276:(e,t,r)=>{r.d(t,{v:()=>c});var n=r(91933),i=r.n(n),a=r(3821),o=r(35969),s=r(8553),l=r(6271);function c(e,t){let[r,n]=(0,a.useState)(""),[c,d]=(0,a.useState)({progress:0,up:!1}),[u,p]=(0,a.useState)(null),[m,f]=(0,a.useState)(!1),{isEncrypt:g=!1,secret:h,file:y,isPremium:w=!1,endpoint:b,pinner:v,pin:x,chainId:A}=t,j=(0,a.useMemo)(()=>w?1024:40,[w]),k=(0,a.useMemo)(()=>{if(!y)return!1;if(y.file)return y.file.size>1048576*j;if(y.files){let e=0;for(let t of y.files)e+=t.size;return e>1048576*j}return!1},[y,j]);return{upload:async t=>{try{let r,a,l,c,u=t||y;if(!u)throw Error("Not found file");n(""),f(!0);let m="aptos-martian"===e.wallet||"aptos-petra"===e.wallet?e.pubKey||"":e.account,w="Basic ".concat(e.authBasic),k="Bearer ".concat(e.authBearer),C=i().CancelToken.source();p(C),d({progress:0,up:!0});let I=new FormData;if(g&&h){if(u.file){let e=new Date().getTime(),t=await (0,s.Rg)(u.file);console.info("readFile::",(new Date().getTime()-e)/1e3);let r=await (0,o.o)(t,h);console.info("encrypted::",(new Date().getTime()-e)/1e3);let n=new Blob([r],{type:u.file.type});I.append("file",n,u.file.name)}else if(u.files)for(let e of u.files){let t=await (0,s.Rg)(e),r=await (0,o.o)(t,h),n=new Blob([r],{type:e.type});I.append("file",n,e.webkitRelativePath)}}else if(u.file)I.append("file",u.file,u.file.name);else if(u.files)for(let e of u.files)I.append("file",e,e._webkitRelativePath||e.webkitRelativePath);let S=b.value,_=await i().request({cancelToken:C.token,data:I,headers:{Authorization:w},maxContentLength:j,method:"POST",onUploadProgress:e=>{let t=e.loaded/e.total;d({progress:Math.round(99*t),up:!0})},params:{pin:!0,"cid-version":1,hash:"sha2-256"},url:"".concat(S,"/api/v0/add")});if("string"==typeof _.data){let e=_.data.replaceAll("}\n{","},{"),t=JSON.parse("[".concat(e,"]")),n=t.length-1;r=t[n],delete t[n],r.items=t}else r=_.data;console.info("upResult:",_),p(null),d({progress:99,up:!0}),x?(c=A,l=await x(r.Hash)):(a=v.value,await i().post("".concat(a,"/psa/pins"),{cid:r.Hash,name:r.Name},{headers:{authorization:k}})),d({progress:100,up:!1});let E={...r,PinEndpoint:a,PinTime:new Date().getTime(),UpEndpoint:S,Encrypted:g,PinTx:l,PinChainId:c},N={msg:m,signature:e.signature};return[E,N]}catch(e){var r;if(d({progress:0,up:!1}),f(!1),console.error(e),(null==e||null==(r=e.data)?void 0:r.code)===-32e3)return void n("Insufficient Wallet Balance!");if((null==e?void 0:e.code)==="ACTION_REJECTED")return void n("User has rejected the operation.");throw n((0,l.Yf)(e)),e}},error:k?"Do not upload files larger than ".concat(j,"MB!"):r,isBusy:m,upState:c,cancelUp:u,fileSizeError:k}}},35969:(e,t,r)=>{r.d(t,{I:()=>o,o:()=>a});let n=async e=>window.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),i=async(e,t,r)=>window.crypto.subtle.deriveKey(r,e,{name:"AES-GCM",length:256},!1,t),a=async(e,t)=>{try{let r=new Uint8Array(e),a=new TextEncoder().encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),s=window.crypto.getRandomValues(new Uint8Array(12)),l=await n(a),c=await i(l,["encrypt"],{name:"PBKDF2",salt:o,iterations:25e4,hash:"SHA-256"}),d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},c,r),u=new Uint8Array(d),p=new Uint8Array(u.byteLength+o.byteLength+s.byteLength);return p.set(o,0),p.set(s,o.byteLength),p.set(u,o.byteLength+s.byteLength),p}catch(e){throw console.error("Error encrypting file"),console.error(e),e}},o=async(e,t)=>{try{let r=new Uint8Array(e),a=new TextEncoder().encode(t),o=r.slice(0,16),s=r.slice(16,28),l=r.slice(28),c=await n(a),d=await i(c,["decrypt"],{name:"PBKDF2",salt:o,iterations:25e4,hash:"SHA-256"});return await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s},d,l)}catch(e){console.error("Error decrypting file"),console.error(e);return}}},41207:(e,t,r)=>{r.d(t,{N:()=>c,e:()=>l});var n=r(3821),i=r(18041),a=r(69221),o=r(74638),s=r.n(o);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"upload:last-gateway",{t:r}=(0,a.Bd)(),o=(0,n.useMemo)(()=>e&&e.length>0?e:(0,i.rt)(r).map(e=>{var t,r;return{...e,text:"".concat(null!=(t=e.text)?t:""," (").concat(null!=(r=e.location)?r:"",")")}}),[r,e]),l=(0,n.useMemo)(()=>{let e=s().get(t);if(e){let t=o.findIndex(t=>t.value===e.value);if(t>=0)return t}return 0},[t,o]),[c,d]=(0,n.useState)(o[l]),u=(0,n.useCallback)(e=>{d(r=>{let n="function"==typeof e?e(r):e;return s().set(t,{value:n.value}),n})},[]),p=(0,n.useCallback)((e,t)=>{let{value:r}=t,n=o.find(e=>e.value===r);n&&u(n)},[o,u]);return(0,n.useMemo)(()=>({endpoints:o,endpoint:c,setEndpoint:u,onChangeEndpoint:p}),[o,c,u,p])}function c(){let{t:e}=(0,a.Bd)(),t=(0,n.useMemo)(()=>(0,i.n3)(e).sort(()=>Math.random()>.5?-1:1).map(e=>{var t;return{...e,text:"".concat(null!=(t=e.text)?t:"Pinner")}}),[e]),[r,o]=(0,n.useState)(t[0]),s=(0,n.useCallback)((e,r)=>{let{value:n}=r,i=t.find(e=>e.value===n);i&&o(i)},[t]);return(0,n.useMemo)(()=>({pinner:r,pins:t,setPinner:o,onChangePinner:s}),[r,t,s])}},42972:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(3821),i=r(69221),a=r(87080),o=r(55982),s=r.n(o);function l(){let{t:e}=(0,i.Bd)(),{alert:t}=(0,n.useContext)(a.BR),[r,o]=(0,n.useState)(void 0),l=(0,n.useRef)(),c=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l.current&&(l.current.webkitdirectory=e,l.current.multiple=e,l.current.click())},[l]),d=(0,n.useCallback)(()=>c(!1),[c]),u=(0,n.useCallback)(()=>c(!0),[c]),p=(0,n.useCallback)(r=>{try{console.info("onInputFile:",r.target.files);let n=s().filter(r.target.files||[]),i=s().size(n);if(!n||0==i)return;if(i>2e3)return void t.alert({title:e("Upload"),msg:e("Please do not upload more than 2000 files"),type:"error"});if(0===i)return void t.alert({title:e("Upload"),msg:e("Please select non-empty folder"),type:"error"});if(r.target.webkitdirectory){if(n.length>=1){let e=[];for(let t=0;t<n.length;t++)e.push(n[t]);console.info(e);let[t]=(e[0].webkitRelativePath||"").split("/");t||1!=i?o({files:e,dir:t||"Files"}):o({file:n[0]})}}else o({file:n[0]});r.target.value=""}catch(r){t.alert({title:e("Upload"),msg:"Select file error "+JSON.stringify(r),type:"error"})}},[o,t,e]);return(0,n.useMemo)(()=>({file:r,setFile:o,inputRef:l,_onClickUpFile:d,_onClickUpFolder:u,_onInputFile:p}),[r,l,d,u,p])}},59061:(e,t,r)=>{r.d(t,{Gc:()=>l});var n=r(3821),i=r(34233),a=r(48480);function o(e){return e}function s(e){e.current.isActive=!1,e.current.subscriber&&(e.current.subscriber.then(e=>e()).catch(console.error),e.current.subscriber=null)}function l(e,t,r){let l=function(){let e=(0,n.useRef)(!1);return(0,n.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}(),c=(0,n.useRef)({isActive:!1,serialized:null,subscriber:null}),[d,u]=(0,n.useState)((r||{}).defaultValue);return(0,n.useEffect)(()=>()=>s(c),[]),(0,n.useEffect)(()=>{if(l.current&&e){let[n,d]=function(e,t){let{paramMap:r=o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return[JSON.stringify({f:null==e?void 0:e.name,p:t}),0!==t.length&&t.some(e=>(0,i.k)(e)||(0,a.b)(e))?null:r(t)]}(e,t||[],r);d&&n!==c.current.serialized&&(c.current.serialized=n,function(e,t,r,n,i){let{transform:l=o,withParams:c,withParamsTransform:d}=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=n.filter(e=>!(0,a.b)(e));s(t),setTimeout(()=>{if(e.current){var a;!r||r.meta&&(null==(a=r.meta.type)?void 0:a.isDoubleMap)&&2!==u.length?t.current.subscriber=null:(t.current.isActive=!0,t.current.subscriber=r(...n,r=>{e.current&&t.current.isActive&&e.current&&t.current.isActive&&i(c?[n,l(r)]:d?l([n,r]):l(r))}))}},0)}(l,c,e,d,u,r))}},[e,r,l,t]),d}},67719:(e,t,r)=>{r.d(t,{A:()=>g});var n=r(29913),i=r(3821),a=r(59544),o=r(23472),s=r(87998),l=r(64875),c=r(55982),d=r.n(c),u=r(11170),p=r.n(u);let m="_null",f=e=>{let{expand:t,list:r,group:i,select:a,onClickItem:o,onClickGroup:s,renderGroupTitle:l=()=>{}}=e,c=i===a.group;return(0,n.jsxs)("div",{className:"group",children:[i!==m&&(l&&l({group:i,select:a,onClickGroup:s})||(0,n.jsxs)("div",{className:p()("title",{active:c}),onClick:s,children:[i," ",(0,n.jsx)("span",{className:"dropIcon cru-fo-chevron-down"})]})),t&&r.map((e,t)=>(0,n.jsx)("div",{className:p()("item",{active:c&&e.value===a.value}),onClick:t=>o(t,{group:i,value:e.value}),children:e.text},"group_item_".concat(t)))]})},g=i.memo((0,o.Ay)(function(e){var t;let{className:r,label:o,help:c,options:u,defaultValue:g,defaultGroup:h=m,renderGroupTitle:y,footer:w}=e,[b,v]=(0,i.useState)({value:g,group:h}),x=(0,i.useMemo)(()=>d().find(u,e=>(e.group||m)===b.group&&e.value===b.value),[u,b]),[A,j]=(0,i.useState)(h),[k,C]=(0,s.e)(),I=(0,l.A)(()=>{k&&C(!1)}),S=(0,i.useMemo)(()=>d().groupBy(u,e=>e.group||m),[u]),_=d().keys(S);return(0,n.jsxs)("div",{className:p()(r,"mdropdown"),onClick:()=>C(),ref:I,children:[o&&(0,n.jsxs)("div",{className:"label font-sans-semibold",children:[o,c&&(0,n.jsx)(a.A,{position:"top center",trigger:(0,n.jsx)("span",{className:"icon cru-fo-help-circle"}),content:c})]}),(0,n.jsx)("span",{className:p()("dropIcon","cru-fo-chevron-down")}),(0,n.jsx)("div",{className:"text font-sans-regular",children:null!=(t=null==x?void 0:x.text)?t:""}),k&&(0,n.jsxs)("div",{className:"options",children:[_.map((t,r)=>(0,n.jsx)(f,{group:t,renderGroupTitle:y,select:b,expand:A===t||t===m,list:S[t],onClickGroup:e=>{j(A===t?m:t),e.stopPropagation()},onClickItem:(t,r)=>{var n;v(r),null==(n=e.onChange)||n.call(e,t,r)}},"group_".concat(r))),w]})]})}).withConfig({componentId:"sc-d8549cd0-0"})(["&.mdropdown{position:relative;width:100%;border-radius:0.57rem;border:1px solid var(--line-color);padding:0.8rem 1rem;cursor:pointer;.label{font-size:1rem;font-weight:600;white-space:nowrap;color:var(--main-color);margin-bottom:0.6rem;.icon{font-size:1.3rem;position:relative;top:0.2rem;margin-left:0.86rem;cursor:pointer;color:var(--secend-color);}}.dropIcon{float:right;position:relative;top:-0.9rem;right:0;}.text{font-size:1rem;color:#999999;}.options{width:100%;background:white;max-height:",";overflow-y:auto;position:absolute;top:calc(100% + 1px);left:0;z-index:10;border-radius:4px;border:1px solid var(--line-color);box-shadow:0 1px 5px rgba(0,0,0,0.3);.group{.title{cursor:pointer;border-top:1px solid var(--line-color);padding:0.8rem 1rem;font-size:1.2rem;font-weight:500;&:hover,&.active{background:var(--line-color);}.dropIcon{float:right;right:0.6rem;top:0rem;}}.item{padding:0.6rem 1.6rem;cursor:pointer;&:hover,&.active{background:var(--line-color);}}}}}"],e=>e.optionsMaxHeight||"300px"))},72146:(e,t,r)=>{r.d(t,{G:()=>c});var n=r(29913),i=r(3821),a=r(23472),o=r(75696),s=r(11170),l=r.n(s);let c=i.memo((0,a.Ay)(function(e){let{className:t,onClickUpFile:r,onClickUpFolder:i,disabled:a}=e;return i?(0,n.jsx)(o.A,{className:l()(t,{disabled:a}),pointing:"top",icon:null,basic:!0,text:"Upload",children:(0,n.jsxs)(o.A.Menu,{children:[(0,n.jsx)(o.A.Item,{text:"File",icon:(0,n.jsx)("span",{className:"icon cru-fo-file"}),onClick:r}),(0,n.jsx)(o.A.Item,{text:"Folder",icon:(0,n.jsx)("span",{className:"icon cru-fo-folder"}),onClick:i})]})}):(0,n.jsx)("div",{className:l()("btn-upload",{disabled:a},t),onClick:r,children:"Upload"})}).withConfig({componentId:"sc-dbde77e9-0"})(["&.btn-upload,&.ui.dropdown>.text.divider{padding:0 4.285714rem;font-family:OpenSans-Medium;font-size:2.571429rem;line-height:6.428571rem;cursor:pointer;border:2px solid #000000;box-sizing:border-box;border-radius:1.714286rem;}&.disabled{background:#EEEEEE;border:unset !important;color:#AAAAAA;cursor:not-allowed;}&.ui.dropdown{.cru-fo{font-size:1.3rem;margin-left:1.1rem;}.menu::after{display:none;}.menu{width:100%;background:#FFFFFF;box-shadow:0 0.57rem 1.43rem 0 rgba(0,0,0,0.1);border:1px solid #EEEEEE;border-radius:0.86rem;padding:0.57rem;.icon{margin-left:1.144286rem;margin-right:1.714286rem;}.item{padding:0.78rem 0.57rem !important;border-radius:0.57rem;font-size:1.285714rem;&:active{background-color:#EEEEEE;}}}}"]))},75317:(e,t,r)=>{r.d(t,{A:()=>H});var n=r(29913),i=r(55982),a=r.n(i),o=r(3821),s=r(69221),l=r(63655),c=r(49403),d=r(50826),u=r(70193),p=r(23472),m=r(87998),f=r(87545),g=r(49238),h=r(56105),y=r(95251);let w=JSON.parse('{"name":"StorageOrder","methods":[{"name":"create","args":[],"returns":{"type":"void"}},{"name":"bootstrap","args":[{"type":"pay","name":"seed"},{"type":"uint64","name":"base_price"},{"type":"uint64","name":"byte_price"},{"type":"uint64","name":"size_limit"},{"type":"uint64","name":"service_rate"},{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"set_base_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_byte_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_size_limit","args":[{"type":"uint64","name":"size"}],"returns":{"type":"void"}},{"name":"set_service_rate","args":[{"type":"uint64","name":"rate"}],"returns":{"type":"void"}},{"name":"set_algo_cru_price","args":[{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"add_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"remove_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"get_random_order_node","args":[],"returns":{"type":"address"}},{"name":"get_price","args":[{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"uint64"}},{"name":"place_order","args":[{"type":"pay","name":"seed"},{"type":"account","name":"merchant"},{"type":"string","name":"cid"},{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"void"}}],"networks":{},"desc":"This is storage order contract used to place order"}');var b=r(46370),v=r(35295),x=r(43783).Buffer;let A=new g.Ay.Algodv2(b.jI.token,b.jI.algodUrl);class j{constructor(){this.base_price=h.gH.from(0),this.byte_price=h.gH.from(0),this.service_rate=h.gH.from(0),this.algo_price=h.gH.from(0),this.cru_price=h.gH.from(0)}}async function k(e,t){let r=await A.getApplicationByID(b.jI.applicationId).do(),n=new j,i=new Set(Object.keys(n));for(let e of r.params["global-state"]){let t=x.from(e.key,"base64").toString();i.has(t)&&(n[t]=h.gH.from(e.value.uint))}let a=n.base_price.add(n.byte_price.mul(e).div(1024).div(1024)).mul(n.service_rate.add(100)).div(100).mul(n.cru_price).div(n.algo_price).div(h.gH.from("1".concat("0".repeat(12))));return t?a.mul(200):a}async function C(e,t,r,n){var i;let o=e.useWallet,s=(i=o.wallet,async(e,t)=>{let r=a().map(t,t=>({txn:e[t]}));return Promise.resolve(await i.signTransaction([r]))}),l=await A.getTransactionParams().do(),c=new g.Ay.ABIContract(w),d=await k(r,n),u=await A.accountInformation(o.account).do();if(h.gH.from(u.amount).lt(d))throw"Insufficient Balance";let p=await I(),m=g.Ay.makePaymentTxnWithSuggestedParamsFromObject({from:o.account,to:b.jI.applicationAddress,amount:BigInt(d.toString()),suggestedParams:l}),f=new g.Ay.AtomicTransactionComposer,y=[];for(let e of(y.push({appIndex:b.jI.applicationId,name:g.Ay.decodeAddress(p).publicKey},{appIndex:b.jI.applicationId,name:new Uint8Array(x.from("nodes"))}),f.addMethodCall({appID:b.jI.applicationId,method:c.getMethodByName("place_order"),methodArgs:[{txn:m,signer:s},p,t,r,n],sender:o.account,signer:s,boxes:y,suggestedParams:l}),(await f.execute(A,4)).methodResults))return e.txID}async function I(){let e="node_num",t=await A.getApplicationByID(b.jI.applicationId).do(),r=g.Ay.ABIType.from("string"),n=r.encode(e).slice(-e.length),i=x.from(n).toString("base64"),a=0;for(let e of t.params["global-state"])if(e.key===i){a=e.value.uint;break}if(0===a)throw Error("No merchant node for algorand user to order.");let o=Math.floor(Math.random()*a),s="nodes",l=r.encode(s).slice(-s.length),c=await A.getApplicationBoxByName(b.jI.applicationId,l).do(),d=new Uint8Array(g.Ay.ABIType.from("uint8[32][30]").decode(c.value)[o].map(e=>Number(e)));return g.Ay.encodeAddress(d)}var S=r(41207),_=r(17390),E=r(88449),N=r.n(E);function P(){var e;return null==(e=(0,v.ZR)().useWallet)?void 0:e.chainId}var z=r(29380),F=r(27276),T=r(64881),M=r(67719),B=r(18041);let D=p.Ay.div.withConfig({componentId:"sc-229e1e04-0"})(["cursor:pointer;height:40px;line-height:40px;color:var(--primary-color);text-align:center;"]),R=()=>{},H=o.memo((0,p.Ay)(function(e){let{wallet:t}=(0,v.ZR)(),{className:r,uc:p,file:g,onClose:w=R,onSuccess:x=R,user:A,type:j,isPremium:I}=e,E="vault"===j,{t:B}=(0,s.Bd)(),{endpoint:H,endpoints:U,onChangeEndpoint:L}=(0,S.e)(),{onChangePinner:G,pinner:O,pins:W}=(0,S.N)(),[K,V]=(0,m.e)(!0),q=(0,o.useMemo)(()=>{let e=g.file?g.file.size:g.files?a().sumBy(g.files,"size")+1024:0;return 0===e?e:e+Math.round(.2*e)},[g]),{pin:J,fee:Z,chainId:Y}="algorand"===t?function(e,t){let{wallet:r}=(0,v.ZR)(),n=(0,v.ZR)(),[a,s]=(0,o.useState)("-"),l=(0,o.useRef)("");return(0,o.useEffect)(()=>{let n=(0,i.uniqueId)();return l.current=n,s("-"),"algorand"===r&&k(BigInt(e),t).then(e=>{l.current==n&&s(y.formatUnits(e.toString(),6)+" "+(b.P8[b.jI.chainId]||"ETH"))}).catch(console.error),()=>{}},[e,t,r]),{pin:async r=>await C(n,r,BigInt(e),t),chainId:b.jI.chainId,fee:a}}(q,K):function(e,t){let r=P(),n=function(){let e=function(){let e=(0,v.ZR)();return(0,o.useMemo)(()=>{var t,r;if(null==(t=e.useWallet)?void 0:t.getProvider)return null==(r=e.useWallet)?void 0:r.getProvider()},[e])}(),t=P();return(0,o.useMemo)(()=>{if(!e||null==t)return;let r=b.Qh[t];if(r)return z.PM.getContract(r,b.W_,e.getSigner())},[e,t])}(),{useWallet:i}=(0,v.ZR)(),[a,s]=(0,o.useState)("-"),l=(0,o.useRef)("");(0,o.useEffect)(()=>{let a=N()();return l.current=a,s("-"),i&&i.isEvmWallet&&n&&n.getPrice(h.gH.from(e),t).then(e=>{l.current==a&&s((0,_.formatEther)(e)+" "+(b.P8[r]||"ETH"))}).catch(console.error),()=>{}},[e,t,r,i]);let c=async r=>{let a=h.gH.from(e),o=await n.getPrice(a,t),s=[r,a,t];if((await i.getProvider().getBalance(i.account)).lt(o))throw"Insufficient Balance";let l=await n.estimateGas.placeOrder(...s,{value:o}),c=await n.placeOrder(...s,{value:o,gasLimit:l.mul(120).div(100)}),{transactionHash:d}=await c.wait();return d};return{pin:n?c:void 0,chainId:r,fee:a}}(q,K),Q=!!J,X=E&&!!p.secret,{error:$,cancelUp:ee,upState:et,upload:er,isBusy:en,fileSizeError:ei}=(0,F.v)(A,{isEncrypt:!!X,secret:p.secret,file:g,isPremium:I,endpoint:H,pinner:O,pin:J,chainId:Y}),ea=(0,o.useCallback)(()=>{ee&&ee.cancel(),w()},[ee,w]);console.log("filesize error",ei),console.log("isVault error",E),console.log("uc.secret",p.secret),console.log("user.account",A.account),console.log("!user.sign",!A.sign);let eo=ei||E&&!p.secret||!A.account||!A.sign;return(0,n.jsxs)(l.A,{closeIcon:(0,n.jsx)("span",{className:"close icon cru-fo-x"}),onClose:ea,open:!0,size:"large",className:r,children:[(0,n.jsx)(l.A.Header,{className:"font-sans-semisold",children:B(g.dir?"Upload Folder":"Upload File")}),(0,n.jsxs)(l.A.Content,{children:[(0,n.jsxs)(c.A.Group,{children:[(0,n.jsx)(c.A,{fluid:!0,children:(0,n.jsxs)(c.A.Content,{children:[(0,n.jsx)(c.A.Header,{content:g.dir?"Folder":"File"}),(0,n.jsx)(c.A.Description,{content:g.dir?"".concat(g.dir," (").concat(g.files.length," files)"):"".concat(g.file.name," (").concat(g.file.size," bytes)")})]})}),(0,n.jsx)(c.A,{fluid:!0,children:(0,n.jsx)(M.A,{fluid:!0,selection:!0,className:"clear-border",help:B("File streaming and wallet authentication will be processed by the chosen gateway."),disabled:en,label:B("Select a free Web3 IPFS Gateway"),onChange:L,options:U,optionsMaxHeight:"240px",defaultGroup:H.group,defaultValue:H.value,footer:(0,n.jsx)(D,{onClick:()=>window.open("https://wiki.crust.network/docs/en/buildIPFSWeb3AuthGW","_blank"),children:"Contribute IPFS W3Auth Gateway"})})}),Q?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{fluid:!0,className:"encryption",children:(0,n.jsxs)(c.A.Content,{children:[(0,n.jsx)(c.A.Header,{content:"Permanent storage"}),(0,n.jsx)(c.A.Description,{style:{color:K?"transparent":void 0},content:K?"-":"Non-permanent storage, the guarantee period for the file is only 6 months."}),(0,n.jsx)(d.A,{toggle:!0,defaultChecked:K,onChange:(e,t)=>{let{checked:r}=t;return V(r)}})]})}),(0,n.jsxs)("div",{style:{padding:"0 20px"},children:["Storage fee: ",Z]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{fluid:!0,children:(0,n.jsx)(M.A,{fluid:!0,selection:!0,className:"clear-border",help:B("Your file will be pinned to IPFS for long-term storage."),disabled:0===W.length,label:B("Select a Web3 IPFS Pinner"),onChange:G,options:W,defaultValue:O.value,footer:(0,n.jsx)(D,{onClick:()=>window.open("https://wiki.crust.network/docs/en/buildIPFSW3AuthPin","_blank"),children:"Contribute IPFS W3Auth Pinner"})})}),(0,n.jsx)(c.A,{fluid:!0,className:"encryption",children:(0,n.jsxs)(c.A.Content,{children:[(0,n.jsx)(c.A.Header,{content:"File Encryption"}),p.secret?(0,n.jsx)(c.A.Description,{content:X?"Yes":"File encryption is disabled in Public Mode."}):(0,n.jsx)(c.A.Description,{content:"Please go to the 'Setting' page and set encryption key before activating this function."}),(0,n.jsx)(d.A,{toggle:!0,defaultChecked:X,disabled:!0})]})})]})]}),$&&(0,n.jsx)("div",{style:{color:"orangered",padding:"1rem",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:$})]}),(0,n.jsx)(l.A.Actions,{children:(0,n.jsxs)("div",{className:"uploading",children:[et.up&&(0,n.jsx)(u.A,{value:et.progress,total:100,active:!0,color:"orange"}),et.up&&(0,n.jsx)(T.A,{onClick:ea,children:B("Cancel")}),!et.up&&(0,n.jsx)(T.A,{fluid:!0,onClick:()=>{eo||er().then(e=>{let[t]=e;return x(t),(0,f.z)({type:2,walletType:A.wallet,address:A.account,data:{cid:t.Hash,fileType:+!!a().size(t.items),strategy:+!!t.Encrypted}})}).catch(console.error)},disabled:eo,children:B("Confirm")})]})})]})}).withConfig({componentId:"sc-229e1e04-1"})(['width:51.43rem !important;.header:nth-child(2){height:3.93rem;font-size:1.3rem !important;padding:0 1.14rem !important;font-weight:600 !important;line-height:3.93rem !important;}.close.icon{top:0.5rem;right:0.6rem;color:#666666;}.content{padding:1rem !important;}.ui.cards > .card{margin:0.5rem !important;.content > .header{font-size:1rem;font-weight:unset !important;color:var(--main-color);font-weight:600;font-family:OpenSans-SemiBold;}.content > .description{font-size:1rem;color:#999999;font-family:OpenSans-Regular;}}.ui.cards > .card:first-child{margin-top:1rem !important;}.toggle-options{cursor:pointer;font-size:10px;color:#999999;line-height:14px;margin-top:8px;margin-left:1.51rem;.cru-fo{font-size:14px;position:relative;top:2px;margin-left:6px;}}.actions{height:4.8rem;padding:0.5rem 1rem 0 1rem !important;border-top:unset !important;background:unset !important;.button{margin-left:unset !important;}}.uploading{height:4rem;display:flex;align-items:center;.progress{margin:0 1rem 0 0 !important;vertical-align:baseline;background:unset !important;border:1px solid orange;flex:1;.bar{min-width:unset !important;height:2.5rem;}}}.card.encryption{position:relative;.toggle{position:absolute;top:calc(50% - 0.75rem);right:1rem;input[type="radio"]:checked + label:before{background-color:#2ed158 !important;}}}',"{width:95% !important;}"],B.TQ))},78690:(e,t,r)=>{r.d(t,{Ay:()=>g});var n=r(29913),i=r(3821),a=r(39889),o=r(17468),s=r(8553),l=r(55982),c=r.n(l),d=r(20692),u=r(23472),p=r(84371),m=r(18041),f=r(31012);let g=i.memo((0,u.Ay)(function(e){let{className:t,pageCount:r=10,files:l,type:u="public",onDeleteItem:m}=e,g=(0,p.useRouter)();(0,f.a)();let h="public"===u,y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,[r,n]=(0,i.useState)(1);return(0,i.useMemo)(()=>{let i=c().chunk(e,t);return{totalPage:i.length,pageList:i[r-1]||[],setPage:n,page:r}},[e,r])}((0,i.useMemo)(()=>l.filter(e=>"public"===u?!e.Encrypted:e.Encrypted),[l,u]),r),w=(0,s.Kv)(),b=y.totalPage>1?2:5;return(0,n.jsx)("div",{className:t,children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{className:"font-sans-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"File Name"}),(0,n.jsx)("th",{children:"File CID"}),(0,n.jsx)("th",{children:"File Size"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Action"}),h&&(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{className:"font-sans-regular",children:y.pageList.map((e,t)=>(0,n.jsx)(d.A,{type:u,onDelete:m,uc:w,file:e},"files_item_".concat(t)))}),(0,n.jsx)("tfoot",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{colSpan:h?b+1:b,className:"btns",children:(0,n.jsxs)("div",{className:"files-tip",children:["The file list is locally cached. If you want to keep this list when switching to another device, please go to ",(0,n.jsx)("span",{onClick:()=>g.push("/setting"),children:"Settings->User Data Management"})," to migrate your user data."]})}),y.totalPage>1&&(0,n.jsx)("td",{colSpan:3,children:(0,n.jsx)(a.A,{totalPages:y.totalPage,activePage:y.page,firstItem:null,lastItem:null,prevItem:{content:(0,n.jsx)(o.A,{name:"angle left"}),icon:!0},nextItem:{content:(0,n.jsx)(o.A,{name:"angle right"}),icon:!0},secondary:!0,onPageChange:(e,t)=>{let{activePage:r}=t;return y.setPage(r)}})})]})})]})})}).withConfig({componentId:"sc-69c67fad-0"})(["padding:1rem 2rem;width:100%;thead{font-size:1.29rem;font-weight:600;th:first-child{padding-left:0.57rem;text-align:left;}th{padding-bottom:.8em;border-bottom:unset;}}table{border-spacing:0;min-width:100%;}tbody{color:var(--secend-color);tr > td{padding:.785em;}tr > td:first-child{padding-left:0.57rem;}tr:nth-child(2n - 1){background-color:#f8f8f8;td:first-child{overflow:hidden;border-top-left-radius:0.57rem;border-bottom-left-radius:0.57rem;text-align:left;}td:last-child{overflow:hidden;border-top-right-radius:0.57rem;border-bottom-right-radius:0.57rem;}}}tfoot{.btns > button{margin-right:1rem !important;}tr > td{padding:8px 0;border-top:solid 1px var(--line-color);border-bottom:solid 1px var(--line-color);}th{border-top:unset !important;}.btns{span{cursor:pointer;color:#808080;}}.btns > i{color:var(--secend-color);cursor:pointer;}.pagination > .item{color:var(--secend-color);padding:0.8rem 1rem !important;min-width:unset !important;border-radius:5rem !important;margin:unset;}.files-tip{font-size:13px;line-height:22px;color:#999999;padding-left:0.57rem;span{color:var(--primary-color);}}}","{overflow-x:auto;padding:16px;box-shadow:0px 0px 16px 0px #0000001A;border-radius:12px;table{min-width:600px;}tfoot > tr{border-top:none;border-bottom:none;}}"],m.TQ))},84702:(e,t,r)=>{r.d(t,{j:()=>u});var n=r(29913),i=r(11170),a=r.n(i),o=r(3821),s=r(53632),l=r(23472),c=r(87998);async function d(e){if(!e.files.length)return null;let t=e.items,r={files:[]},n=1===t.length,i=[];for(let e=0;e<t.length;e++){let a=t[e],o=a.webkitGetAsEntry();o&&o.isDirectory?(n&&(r.dir=o.name),i.push({reader:o.createReader(),path:o.name})):o&&(n?r.file=a.getAsFile():r.files.push(a.getAsFile()))}for(let e of i){let t=await function e(t,r){return new Promise(n=>{let i=[];t.readEntries(async a=>{if(a.length){for(let t of a)t.isFile?i.push(await function(e,t){return new Promise(r=>{e.file(e=>{e._webkitRelativePath="".concat(t,"/").concat(e.name),r(e)})})}(t,r)):t.isDirectory&&(i=i.concat(await e(t.createReader(),"".concat(r,"/").concat(t.name))));i=i.concat(await e(t,r))}n(i)})})}(e.reader,e.path);r.files=r.files.concat(t)}return r}let u=o.memo((0,l.Ay)(function(e){let{className:t}=e,[r,i]=(0,c.e)(),[l,u]=(0,o.useState)(null),p=async t=>{t.preventDefault();let r=await d(t.dataTransfer);console.info("fielInfo:",r),i(!1),r&&e.onDrop&&e.onDrop(r)};return((0,o.useEffect)(()=>{u(document.getElementById("__next"))},[]),(0,o.useEffect)(()=>{if(!l)return;let e=e=>{e.preventDefault(),i(!0)},t=e=>{"_drap_drop_frame"===e.target.id&&i(!1)};return l.addEventListener("dragenter",e),l.addEventListener("dragleave",t),()=>{let r=document.getElementById("_drap_drop_frame");r&&l.removeChild(r),l.removeEventListener("dragenter",e),l.removeEventListener("dragleave",t)}},[l]),l)?s.createPortal((0,n.jsx)("div",{id:"_drap_drop_frame",onDrop:p,onDragOver:e=>e.preventDefault(),className:a()(t,{show:r}),children:"Upload files to this directory"}),l):null}).withConfig({componentId:"sc-bc701bf8-0"})(["position:fixed;width:100vw;height:100vh;z-index:9999999;left:0;top:0;background:rgba(255,255,255,0.7);border:3px dashed #cccccc;box-sizing:border-box;display:none;align-items:center;justify-content:center;font-weight:600;font-size:36px;&.show{display:flex;}"]))},87545:(e,t,r)=>{r.d(t,{z:()=>o});var n=r(91933),i=r.n(n),a=r(34133);function o(e){return i().post((0,a.cO)("/common/report"),e).catch(console.error)}},93268:(e,t,r)=>{r.d(t,{V:()=>l});var n=r(3821),i=r(55982),a=r.n(i),o=r(36450),s=r.n(o);function l(e){return(0,n.useMemo)(()=>{let t=e.files.length,r=a().groupBy(e.files,e=>e.Encrypted?"valut":"public");r.public||(r.public=[]),r.valut||(r.valut=[]);let n=a().size(r.public),i=a().size(r.valut);return{count:t,publicCount:n,valutCount:i,publicSize:s()(a().sumBy(r.public,e=>a().toNumber(e.Size))).toUpperCase(),valutSize:s()(a().sumBy(r.valut,e=>a().toNumber(e.Size))).toUpperCase()}},[e.files])}}}]);