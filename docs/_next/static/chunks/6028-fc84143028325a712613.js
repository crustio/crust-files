"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6028],{66028:function(e,t,n){n.d(t,{N:function(){return D}});var r=n(30266),a=n(809),c=n.n(a),i=n(6169),s=n(9669),o=n.n(s),u=n(93162),l=n(56755),p=n.n(l),f=n(96486),d=n.n(f),m=n(67294),h=n(1300),v=n(22090),y=n(65382),w=n(29163),b=n(12752),g=n(54040),x=n(65369),k=n(20478),j=n(81496),O=n(59996),C=n(45129),S=n(56262),E=n(99056),N=n(57908),Z=n(60954),P=n(85893),D=["https://crustipfs.live","https://crustipfs.art","https://crustipfs.info","https://web3files.world","https://web3files.live","https://storagefiles.site","https://storagefiles.space","https://crustipfs.tech"];function A(e,t,n){return"".concat(n,"/ipfs/").concat(e.Hash,"?filename=").concat(e.Name)}function T(e,t){return _.apply(this,arguments)}function _(){return(_=(0,r.Z)(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.Cn)(t.Hash,{name:t.Name,encrypted:t.Encrypted,gateway:t.UpEndpoint,fromAccount:n.account,fromWallet:n.wallet,from:n.nickName,isDir:!!t.items});case 2:return r=e.sent,(0,O.H)({type:3,walletType:n.wallet,address:n.account,data:{cid:t.Hash,fileType:t.items?1:0,strategy:t.Encrypted?1:0,shareType:0}}),e.abrupt("return","".concat(window.location.origin,"/share?code=").concat(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return{expired_at:0,reported_replica_count:0,amount:0,file_size:0,prepaid:!1}}}t.Z=m.memo((0,w.ZP)((function(e){var t,n,a,s,l=e.file,f=e.className,w=e.uc,O=e.onDelete,C=e.type,D="public"===(void 0===C?"public":C),_=(0,k.V)(),M=(0,m.useContext)(b.Il),F=M.api,L=M.alert,H=M.loading,R=(0,S.T)().endpoints,I=(0,j.z)().gateway,U=(0,m.useCallback)((0,r.Z)(c().mark((function e(){var t,n,r,a,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.Encrypted||0!==d().size(l.items)){e.next=29;break}if(e.prev=1,w.secret){e.next=4;break}return e.abrupt("return");case 4:return H.show(),t=A(l,0,I),e.next=8,o().get(t,{responseType:"arraybuffer"});case 8:return n=e.sent,console.info("res::",n),r=(new Date).getTime(),e.next=13,(0,g.n)(n.data,w.secret);case 13:if(a=e.sent,console.info("decrypt:",((new Date).getTime()-r)/1e3),a){e.next=17;break}throw"error";case 17:console.info("de:",a),i=new File([a],l.Name,{type:n.headers["content-type"]}),(0,u.saveAs)(i,l.Name),H.hide(),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),H.hide(),L.error("Decrypt error");case 27:e.next=31;break;case 29:s=A(l,0,I),window.open(s,"_blank");case 31:case"end":return e.stop()}}),e,null,[[1,23]])}))),[w,l,R,I]),q=(0,N.WY)(),G=function(){var e=(0,r.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T(l,q);case 3:t=e.sent,window.open(t,"_blank"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),L.error((0,E.az)(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=(0,r.Z)(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T(l,q);case 3:t=e.sent,n=q.nickName?"Check out what '".concat(q.nickName,"' is sharing on Crust Files!"):"Check out what I am sharing on Crust Files!",r="https://twitter.com/intent/tweet?text=".concat(encodeURI(n),"&url=").concat(encodeURIComponent(t),"&hashtags=web3,ipfs,crustnetwork,metaverse,crustfiles"),window.open(r,"_blank"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),L.error((0,E.az)(e.t0));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),V=F&&(null===(t=F.query)||void 0===t?void 0:t.market)&&((0,i.m)(F.query.market.filesV2)?F.query.market.filesV2:F.query.market.files),W=F&&(null===(n=F.query)||void 0===n?void 0:n.market)&&F.query.market.files,J=!!V,B=(0,x.W7)(V,[l.Hash]),X=(0,x.W7)(W,[l.Hash]),$=(0,x.W7)(null===F||void 0===F||null===(a=F.derive)||void 0===a||null===(s=a.chain)||void 0===s?void 0:s.bestNumber),Q=$&&$.toNumber(),Y=(0,m.useMemo)((function(){var e={status:"Submitted"};if(X&&!X.isEmpty){var t=z(X),n=t.expired_at,r=t.reported_replica_count,a=t.amount,c=t.file_size,i=t.prepaid;e.expireTime=n,e.amount=a,e.startTime=n?n-216e3:0,e.fileSize=c,e.confirmedReplicas=r,e.prepaid=i,n&&n<Q&&(e.status="Expired"),r<1&&(e.status="Submitted"),n&&n>Q&&r>0&&(e.status="Success")}else if(B&&!B.isEmpty){var s=z(B),o=s.expired_at,u=s.reported_replica_count,p=s.amount,f=s.file_size,d=s.prepaid;e.expireTime=o,e.amount=p,e.startTime=o?o-216e3:0,e.fileSize=f,e.confirmedReplicas=u,e.prepaid=d,o&&o<Q&&(e.status="Expired"),u<1&&(e.status="Submitted"),o&&o>Q&&u>0&&(e.status="Success")}else J&&(new Date).getTime()-l.PinTime>=72e5&&(e.status="Failed");return Q||(e.status="Loading"),e}),[X,B,Q]);return(0,P.jsxs)(h.Z.Row,{className:f,children:[(0,P.jsxs)(h.Z.Cell,{className:"fileName",children:[(0,E.lS)(l.Name),l.items&&(0,P.jsx)("span",{className:"icon cru-fo-folder"}),l.Encrypted&&(0,P.jsx)(v.Z,{trigger:(0,P.jsx)("span",{className:"icon cru-fo-key"}),content:"Encrypted",position:"top center"})]}),(0,P.jsxs)(h.Z.Cell,{textAlign:"right",children:[(0,E.lS)(l.Hash),(0,P.jsx)(v.Z,{position:"top center",content:"Copy File CID",trigger:(0,P.jsx)("span",{className:"cru-fo cru-fo-copy",onClick:function(){return _(l.Hash)},style:{marginLeft:"1.8rem"}})})]}),(0,P.jsx)(h.Z.Cell,{textAlign:"center",style:{textTransform:"uppercase"},children:p()(Number(l.Size),{round:2})}),(0,P.jsxs)(h.Z.Cell,{textAlign:"center",children:["Loading"===Y.status&&(0,P.jsx)(y.Z,{loading:!0,name:"spinner"}),"Submitted"===Y.status&&Y.status,"Expired"===Y.status&&Y.status,"Failed"===Y.status&&Y.status,"Success"===Y.status&&"".concat(Y.status," (").concat(Y.confirmedReplicas," Replicas)")]}),(0,P.jsxs)(h.Z.Cell,{textAlign:"center",children:[(0,P.jsx)(v.Z,{position:"top center",content:"Open",trigger:(0,P.jsx)("span",{className:"cru-fo cru-fo-external-link",style:{marginLeft:"1rem"},onClick:U})}),(0,P.jsx)(v.Z,{position:"top center",content:"Delete",trigger:(0,P.jsx)("span",{className:"cru-fo cru-fo-trash-2",style:{marginLeft:"1rem"},onClick:function(){O(l)}})}),(0,P.jsx)(v.Z,{position:"top center",content:"IPFS Scan",trigger:(0,P.jsx)("span",{className:"cru-fo cru-fo-search",style:{marginLeft:"1rem"},onClick:function(){window.open("https://ipfs-scan.io?cid=".concat(l.Hash),"_blank")}})})]}),D&&(0,P.jsx)(h.Z.Cell,{textAlign:"center",children:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Z.Z,{className:"item-share-btn",onClick:G,children:"Share"}),(0,P.jsx)(v.Z,{position:"top center",content:"Quick Tweet",trigger:(0,P.jsx)("span",{className:"cru-fo cru-fo-twitter",onClick:K,style:{marginLeft:"0.5rem",top:"0.2rem"}})})]})})]})})).withConfig({displayName:"FileItem",componentId:"sc-3bbeav-0"})(["color:var(--secend-color) !important;.cru-fo,.icon{cursor:pointer;font-size:1.3rem;position:relative;top:0.3rem;}.fileName{.icon{margin-left:0.6rem;}}.item-share-btn{padding:5px 11px !important;border-radius:8px !important;}"]))},54040:function(e,t,n){n.d(t,{P:function(){return o},n:function(){return u}});var r=n(30266),a=n(809),c=n.n(a),i=function(){var e=(0,r.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=(0,r.Z)(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.crypto.subtle.deriveKey(r,t,{name:"AES-GCM",length:256},!1,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),o=function(){var e=(0,r.Z)(c().mark((function e(t,n){var r,a,o,u,l,p,f,d,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Uint8Array(t),a=(new TextEncoder).encode(n),o=window.crypto.getRandomValues(new Uint8Array(16)),u=window.crypto.getRandomValues(new Uint8Array(12)),e.next=7,i(a);case 7:return l=e.sent,e.next=10,s(l,["encrypt"],{name:"PBKDF2",salt:o,iterations:25e4,hash:"SHA-256"});case 10:return p=e.sent,e.next=13,window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},p,r);case 13:return f=e.sent,d=new Uint8Array(f),(m=new Uint8Array(d.byteLength+o.byteLength+u.byteLength)).set(o,0),m.set(u,o.byteLength),m.set(d,o.byteLength+u.byteLength),e.abrupt("return",m);case 22:throw e.prev=22,e.t0=e.catch(0),console.error("Error encrypting file"),console.error(e.t0),e.t0;case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=(0,r.Z)(c().mark((function e(t,n){var r,a,o,u,l,p,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Uint8Array(t),a=(new TextEncoder).encode(n),o=r.slice(0,16),u=r.slice(16,28),l=r.slice(28),e.next=8,i(a);case 8:return p=e.sent,e.next=11,s(p,["decrypt"],{name:"PBKDF2",salt:o,iterations:25e4,hash:"SHA-256"});case 11:return f=e.sent,e.next=14,window.crypto.subtle.decrypt({name:"AES-GCM",iv:u},f,l);case 14:return d=e.sent,e.abrupt("return",d);case 18:return e.prev=18,e.t0=e.catch(0),console.error("Error decrypting file"),console.error(e.t0),e.abrupt("return");case 23:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}()},65369:function(e,t,n){n.d(t,{W7:function(){return l}});var r=n(80318),a=n(83789),c=n(67294),i=n(66103),s=n(98278);function o(e){return e}function u(e){e.current.isActive=!1,e.current.subscriber&&(e.current.subscriber.then((function(e){return e()})).catch(console.error),e.current.subscriber=null)}function l(e,t,n){var l=function(){var e=(0,c.useRef)(!1);return(0,c.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),e}(),p=(0,c.useRef)({isActive:!1,serialized:null,subscriber:null}),f=(0,c.useState)((n||{}).defaultValue),d=f[0],m=f[1];return(0,c.useEffect)((function(){return function(){return u(p)}}),[]),(0,c.useEffect)((function(){if(l.current&&e){var c=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).paramMap,r=void 0===n?o:n;return[JSON.stringify({f:null===e||void 0===e?void 0:e.name,p:t}),0!==t.length&&t.some((function(e){return(0,i.F)(e)||(0,s.o)(e)}))?null:r(t)]}(e,t||[],n),f=(0,r.Z)(c,2),d=f[0],h=f[1];h&&d!==p.current.serialized&&(p.current.serialized=d,function(e,t,n,r,c){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},l=i.transform,p=void 0===l?o:l,f=i.withParams,d=i.withParamsTransform,m=r.filter((function(e){return!(0,s.o)(e)}));u(t),setTimeout((function(){var i;e.current&&(!n||n.meta&&null!==(i=n.meta.type)&&void 0!==i&&i.isDoubleMap&&2!==m.length?t.current.subscriber=null:(t.current.isActive=!0,t.current.subscriber=n.apply(void 0,(0,a.Z)(r).concat([function(n){e.current&&t.current.isActive&&e.current&&t.current.isActive&&c(f?[r,p(n)]:p(d?[r,n]:n))}]))))}),0)}(l,p,e,h,m,n))}}),[e,n,l,t]),d}},81496:function(e,t,n){n.d(t,{z:function(){return f}});var r=n(92809),a=n(80318),c=n(67294),i=n(58971),s=n.n(i),o=n(34111);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=[{text:"https://ipfs.io",value:"https://ipfs.io"},{text:"https://crustgateway.online",value:"https://crustgateway.online"},{text:"https://gw.w3ipfs.org.cn",value:"https://gw.w3ipfs.org.cn"}];function f(){var e=(0,c.useState)({gateway:"https://ipfs.io"}),t=e[0],n=e[1],r=(0,c.useState)(p),i=r[0],u=r[1];(0,c.useEffect)((function(){var e=s().get("downloadgateway");e&&n(e),s().get("allDownloadGateways"),i&&u(i)}),[]);var f=(0,c.useCallback)((function(e){var t={gateway:e};n(t),s().set("downloadgateway",t)}),[]),d=(0,o.X)((function(){return fetch("https://gist.githubusercontent.com/XueMoMo/2cfc982ce6aefb85e09313b714a029bd/raw/CrustFilesDownloadGateway.json").then((function(e){return e.json()})).then((function(e){return e.map((function(e){return{text:e,value:e}}))}))}),[]),m=(0,a.Z)(d,1)[0];return(0,c.useEffect)((function(){m&&m.length&&(s().set("allDownloadGateways",m),u(m))}),[m]),(0,c.useMemo)((function(){return l(l({},t),{},{set:f,allDownloadGateways:i})}),[t,f,i])}},59996:function(e,t,n){n.d(t,{H:function(){return i}});var r=n(9669),a=n.n(r),c=n(45129);function i(e){return a().post((0,c.uJ)("/common/report"),e).catch(console.error)}},56262:function(e,t,n){n.d(t,{T:function(){return p},q:function(){return f}});var r=n(92809),a=n(67294),c=n(75282),i=n(25443),s=n(58971),o=n.n(s);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"upload:last-gateway",t=(0,i.$)(),n=t.t,r=(0,a.useMemo)((function(){return(0,c.Dl)(n).map((function(e){var t,n;return l(l({},e),{},{text:"".concat(null!==(t=e.text)&&void 0!==t?t:""," (").concat(null!==(n=e.location)&&void 0!==n?n:"",")")})}))}),[n]),s=(0,a.useMemo)((function(){var t=o().get(e);if(t){var n=r.findIndex((function(e){return e.value===t.value}));if(n>=0)return n}return 0}),[e,r]),u=(0,a.useState)(r[s]),p=u[0],f=u[1],d=(0,a.useCallback)((function(t){f((function(n){var r="function"===typeof t?t(n):t;return o().set(e,{value:r.value}),r}))}),[]),m=(0,a.useCallback)((function(e,t){var n=t.value,a=r.find((function(e){return e.value===n}));a&&d(a)}),[r,d]);return(0,a.useMemo)((function(){return{endpoints:r,endpoint:p,setEndpoint:d,onChangeEndpoint:m}}),[r,p,d,m])}function f(){var e=(0,i.$)().t,t=(0,a.useMemo)((function(){return(0,c.qi)(e).sort((function(){return Math.random()>.5?-1:1})).map((function(e){var t;return l(l({},e),{},{text:"".concat(null!==(t=e.text)&&void 0!==t?t:"Pinner")})}))}),[e]),n=(0,a.useState)(t[0]),r=n[0],s=n[1],o=(0,a.useCallback)((function(e,n){var r=n.value,a=t.find((function(e){return e.value===r}));a&&s(a)}),[t]);return(0,a.useMemo)((function(){return{pinner:r,pins:t,setPinner:s,onChangePinner:o}}),[r,t,o])}}}]);