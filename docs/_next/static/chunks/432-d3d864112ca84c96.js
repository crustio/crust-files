"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[432],{32169:function(e,t,n){n.d(t,{U:function(){return l}});var r=n(67294),a=n(54335),i=n(20370),o=n(94184),s=n.n(o),c=n(85893);var l=r.memo((0,a.ZP)((function(e){var t=e.className,n=e.onClickUpFile,r=e.onClickUpFolder,a=e.disabled;return r?(0,c.jsx)(i.Z,{className:s()(t,{disabled:a}),pointing:"top",icon:null,basic:!0,text:"Upload",children:(0,c.jsxs)(i.Z.Menu,{children:[(0,c.jsx)(i.Z.Item,{text:"File",icon:(0,c.jsx)("span",{className:"icon cru-fo-file"}),onClick:n}),(0,c.jsx)(i.Z.Item,{text:"Folder",icon:(0,c.jsx)("span",{className:"icon cru-fo-folder"}),onClick:r})]})}):(0,c.jsx)("div",{className:s()("btn-upload",{disabled:a},t),onClick:n,children:"Upload"})})).withConfig({displayName:"BtnUpload",componentId:"sc-wp55x1-0"})(["&.btn-upload,&.ui.dropdown>.text.divider{padding:0 4.285714rem;font-family:OpenSans-Medium;font-size:2.571429rem;line-height:6.428571rem;cursor:pointer;border:2px solid #000000;box-sizing:border-box;border-radius:1.714286rem;}&.disabled{background:#EEEEEE;border:unset !important;color:#AAAAAA;cursor:not-allowed;}&.ui.dropdown{.cru-fo{font-size:1.3rem;margin-left:1.1rem;}.menu::after{display:none;}.menu{width:100%;background:#FFFFFF;box-shadow:0 0.57rem 1.43rem 0 rgba(0,0,0,0.1);border:1px solid #EEEEEE;border-radius:0.86rem;padding:0.57rem;.icon{margin-left:1.144286rem;margin-right:1.714286rem;}.item{padding:0.78rem 0.57rem !important;border-radius:0.57rem;font-size:1.285714rem;&:active{background-color:#EEEEEE;}}}}"]))},19636:function(e,t,n){n.d(t,{N:function(){return P}});var r=n(50029),a=n(87794),i=n.n(a),o=n(6169),s=n(9669),c=n.n(s),l=n(93162),u=n(56755),p=n.n(u),d=n(96486),f=n.n(d),m=n(67294),h=n(65927),g=n(33938),v=n(45150),y=n(54335),b=n(90356),x=n(51117),w=n(38558),k=n(31798),j=n(65572),Z=n(56593),C=n(61509),_=n(31031),S=n(62020),I=n(47687),N=n(98255),E=n(85893),P=["https://crustipfs.live","https://crustipfs.art","https://crustipfs.info","https://web3files.world","https://web3files.live","https://storagefiles.site","https://storagefiles.space","https://crustipfs.tech"];function A(e,t,n){return"".concat(n,"/ipfs/").concat(e.Hash,"?filename=").concat(e.Name)}function F(e,t){return z.apply(this,arguments)}function z(){return(z=(0,r.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.Cn)(t.Hash,{name:t.Name,encrypted:t.Encrypted,gateway:t.UpEndpoint,fromAccount:n.account,fromWallet:n.wallet,from:n.nickName,isDir:!!t.items});case 2:return r=e.sent,(0,Z.H)({type:3,walletType:n.wallet,address:n.account,data:{cid:t.Hash,fileType:t.items?1:0,strategy:t.Encrypted?1:0,shareType:0}}),e.abrupt("return","".concat(window.location.origin,"/share?code=").concat(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return{expired_at:0,reported_replica_count:0,amount:0,file_size:0,prepaid:!1}}}t.Z=m.memo((0,y.ZP)((function(e){var t,n,a,s,u=e.file,d=e.className,y=e.uc,Z=e.onDelete,C=e.type,P="public"===(void 0===C?"public":C),z=(0,k.V)(),D=(0,m.useContext)(b.Il),T=D.api,H=D.alert,U=D.loading,B=(0,_.T)().endpoints,M=(0,j.z)().gateway,W=(0,m.useCallback)((0,r.Z)(i().mark((function e(){var t,n,r,a,o,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.Encrypted||0!==f().size(u.items)){e.next=29;break}if(e.prev=1,y.secret){e.next=4;break}return e.abrupt("return");case 4:return U.show(),t=A(u,0,M),e.next=8,c().get(t,{responseType:"arraybuffer"});case 8:return n=e.sent,console.info("res::",n),r=(new Date).getTime(),e.next=13,(0,x.n)(n.data,y.secret);case 13:if(a=e.sent,console.info("decrypt:",((new Date).getTime()-r)/1e3),a){e.next=17;break}throw"error";case 17:console.info("de:",a),o=new File([a],u.Name,{type:n.headers["content-type"]}),(0,l.saveAs)(o,u.Name),U.hide(),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),U.hide(),H.error("Decrypt error");case 27:e.next=31;break;case 29:s=A(u,0,M),window.open(s,"_blank");case 31:case"end":return e.stop()}}),e,null,[[1,23]])}))),[y,u,B,M]),R=(0,I.WY)(),$=function(){var e=(0,r.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F(u,R);case 3:t=e.sent,window.open(t,"_blank"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),H.error((0,S.az)(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,r.Z)(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F(u,R);case 3:t=e.sent,n=R.nickName?"Check out what '".concat(R.nickName,"' is sharing on Crust Files!"):"Check out what I am sharing on Crust Files!",r="https://twitter.com/intent/tweet?text=".concat(encodeURI(n),"&url=").concat(encodeURIComponent(t),"&hashtags=web3,ipfs,crustnetwork,metaverse,crustfiles"),window.open(r,"_blank"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),H.error((0,S.az)(e.t0));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),G=T&&(null===(t=T.query)||void 0===t?void 0:t.market)&&((0,o.m)(T.query.market.filesV2)?T.query.market.filesV2:T.query.market.files),q=T&&(null===(n=T.query)||void 0===n?void 0:n.market)&&T.query.market.files,V=!!G,Y=(0,w.W7)(G,[u.Hash]),J=(0,w.W7)(q,[u.Hash]),X=(0,w.W7)(null===T||void 0===T||null===(a=T.derive)||void 0===a||null===(s=a.chain)||void 0===s?void 0:s.bestNumber),K=X&&X.toNumber(),Q=(0,m.useMemo)((function(){var e={status:"Submitted"};if(J&&!J.isEmpty){var t=O(J),n=t.expired_at,r=t.reported_replica_count,a=t.amount,i=t.file_size,o=t.prepaid;e.expireTime=n,e.amount=a,e.startTime=n?n-216e3:0,e.fileSize=i,e.confirmedReplicas=r,e.prepaid=o,n&&n<K&&(e.status="Expired"),r<1&&(e.status="Submitted"),n&&n>K&&r>0&&(e.status="Success")}else if(Y&&!Y.isEmpty){var s=O(Y),c=s.expired_at,l=s.reported_replica_count,p=s.amount,d=s.file_size,f=s.prepaid;e.expireTime=c,e.amount=p,e.startTime=c?c-216e3:0,e.fileSize=d,e.confirmedReplicas=l,e.prepaid=f,c&&c<K&&(e.status="Expired"),l<1&&(e.status="Submitted"),c&&c>K&&l>0&&(e.status="Success")}else V&&(new Date).getTime()-u.PinTime>=72e5&&(e.status="Failed");return K||(e.status="Loading"),e}),[J,Y,K]);return(0,E.jsxs)(h.Z.Row,{className:d,children:[(0,E.jsxs)(h.Z.Cell,{className:"fileName",children:[(0,S.lS)(u.Name),u.items&&(0,E.jsx)("span",{className:"icon cru-fo-folder"}),u.Encrypted&&(0,E.jsx)(g.Z,{trigger:(0,E.jsx)("span",{className:"icon cru-fo-key"}),content:"Encrypted",position:"top center"})]}),(0,E.jsxs)(h.Z.Cell,{textAlign:"right",children:[(0,S.lS)(u.Hash),(0,E.jsx)(g.Z,{position:"top center",content:"Copy File CID",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-copy",onClick:function(){return z(u.Hash)},style:{marginLeft:"1.8rem"}})})]}),(0,E.jsx)(h.Z.Cell,{textAlign:"center",style:{textTransform:"uppercase"},children:p()(Number(u.Size),{round:2})}),(0,E.jsxs)(h.Z.Cell,{textAlign:"center",children:["Loading"===Q.status&&(0,E.jsx)(v.Z,{loading:!0,name:"spinner"}),"Submitted"===Q.status&&Q.status,"Expired"===Q.status&&Q.status,"Failed"===Q.status&&Q.status,"Success"===Q.status&&"".concat(Q.status," (").concat(Q.confirmedReplicas," Replicas)")]}),(0,E.jsxs)(h.Z.Cell,{textAlign:"center",children:[(0,E.jsx)(g.Z,{position:"top center",content:"Open",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-external-link",style:{marginLeft:"1rem"},onClick:W})}),(0,E.jsx)(g.Z,{position:"top center",content:"Delete",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-trash-2",style:{marginLeft:"1rem"},onClick:function(){Z(u)}})}),(0,E.jsx)(g.Z,{position:"top center",content:"IPFS Scan",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-search",style:{marginLeft:"1rem"},onClick:function(){window.open("https://ipfs-scan.io?cid=".concat(u.Hash),"_blank")}})})]}),P&&(0,E.jsx)(h.Z.Cell,{textAlign:"center",children:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(N.Z,{className:"item-share-btn",onClick:$,children:"Share"}),(0,E.jsx)(g.Z,{position:"top center",content:"Quick Tweet",trigger:(0,E.jsx)("span",{className:"cru-fo cru-fo-twitter",onClick:L,style:{marginLeft:"0.5rem",top:"0.2rem"}})})]})})]})})).withConfig({displayName:"FileItem",componentId:"sc-3bbeav-0"})(["color:var(--secend-color) !important;.cru-fo,.icon{cursor:pointer;font-size:1.3rem;position:relative;top:0.3rem;}.fileName{.icon{margin-left:0.6rem;}}.item-share-btn{padding:5px 11px !important;border-radius:8px !important;}"]))},83234:function(e,t,n){n.d(t,{ZP:function(){return h}});var r=n(67294),a=n(65927),i=n(93598),o=n(45150),s=n(82675),c=n(96486),l=n.n(c);var u=n(19636),p=n(54335),d=n(11163),f=n(85893);var m=r.memo((0,p.ZP)((function(e){var t=e.className,n=e.pageCount,c=void 0===n?7:n,p=e.files,m=e.type,h=void 0===m?"public":m,g=e.onDeleteItem,v=(0,d.useRouter)(),y="public"===h,b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,r.useState)(1),a=n[0],i=n[1];return(0,r.useMemo)((function(){var n=l().chunk(e,t);return{totalPage:n.length,pageList:n[a-1]||[],setPage:i,page:a}}),[e,a])}((0,r.useMemo)((function(){return p.filter((function(e){return"public"===h?!e.Encrypted:e.Encrypted}))}),[p,h]),c),x=(0,s.MH)(),w=b.totalPage>1?2:5,k=y?w+1:w;return(0,f.jsxs)(a.Z,{basic:"very",className:t,children:[(0,f.jsx)(a.Z.Header,{className:"font-sans-semibold",children:(0,f.jsxs)(a.Z.Row,{children:[(0,f.jsx)(a.Z.HeaderCell,{children:"File Name"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"File CID"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"File Size"}),(0,f.jsx)(a.Z.HeaderCell,{width:"3",textAlign:"center",children:"Status"}),(0,f.jsx)(a.Z.HeaderCell,{width:"2",textAlign:"center",children:"Action"}),y&&(0,f.jsx)(a.Z.HeaderCell,{width:"2"})]})}),(0,f.jsx)(a.Z.Body,{className:"font-sans-regular",children:b.pageList.map((function(e,t){return(0,f.jsx)(u.Z,{type:h,onDelete:g,uc:x,file:e},"files_item_".concat(t))}))}),(0,f.jsx)(a.Z.Footer,{children:(0,f.jsxs)(a.Z.Row,{children:[(0,f.jsx)(a.Z.HeaderCell,{colSpan:k,className:"btns",children:(0,f.jsxs)("div",{className:"files-tip",children:["The file list is locally cached. If you want to keep this list when switching to another device, please go to ",(0,f.jsx)("span",{onClick:function(){return v.push("/setting")},children:"Settings->User Data Management"})," to migrate your user data."]})}),b.totalPage>1&&(0,f.jsx)(a.Z.HeaderCell,{colSpan:"3",textAlign:"right",children:(0,f.jsx)(i.Z,{totalPages:b.totalPage,activePage:b.page,firstItem:null,lastItem:null,prevItem:{content:(0,f.jsx)(o.Z,{name:"angle left"}),icon:!0},nextItem:{content:(0,f.jsx)(o.Z,{name:"angle right"}),icon:!0},secondary:!0,onPageChange:function(e,t){var n=t.activePage;return b.setPage(n)}})})]})})]})})).withConfig({displayName:"FilesTable",componentId:"sc-dquu9o-0"})(["padding:1rem 2rem;width:100%;thead{font-size:1.29rem;font-weight:600;th:first-child{padding-left:0.57rem !important;}th{border-bottom:unset !important;}}tbody{color:var(--secend-color);tr,td{border-top:unset !important;}tr > td:first-child{padding-left:0.57rem !important;}tr:nth-child(2n - 1){background-color:#f8f8f8;td:first-child{overflow:hidden;border-top-left-radius:0.57rem;border-bottom-left-radius:0.57rem;}td:last-child{overflow:hidden;border-top-right-radius:0.57rem;border-bottom-right-radius:0.57rem;}}}tfoot{.btns > button{margin-right:1rem !important;}th{border-top:unset !important;}.btns{span{cursor:pointer;color:#808080;}}.btns > i{color:var(--secend-color);cursor:pointer;}.pagination > .item{color:var(--secend-color);padding:0.8rem 1rem !important;min-width:unset !important;border-radius:5rem !important;margin:unset;}.files-tip{font-size:13px;line-height:22px;color:#999999;padding-left:0.57rem;span{color:var(--primary-color);}}}"])),h=m},51646:function(e,t,n){n.d(t,{R:function(){return x}});var r=n(16835),a=n(50029),i=n(87794),o=n.n(i),s=n(94184),c=n.n(s),l=n(67294),u=n(73935),p=n(54335),d=n(77572),f=n(85893);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){return new Promise((function(n){e.file((function(e){e._webkitRelativePath="".concat(t,"/").concat(e.name),n(e)}))}))}function v(e,t){return new Promise((function(n){var r=[];e.readEntries(function(){var i=(0,a.Z)(o().mark((function a(i){var s,c,l;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.length){a.next=36;break}s=m(i),a.prev=3,s.s();case 5:if((c=s.n()).done){a.next=23;break}if(!(l=c.value).isFile){a.next=15;break}return a.t0=r,a.next=11,g(l,t);case 11:a.t1=a.sent,a.t0.push.call(a.t0,a.t1),a.next=21;break;case 15:if(!l.isDirectory){a.next=21;break}return a.t2=r,a.next=19,v(l.createReader(),"".concat(t,"/").concat(l.name));case 19:a.t3=a.sent,r=a.t2.concat.call(a.t2,a.t3);case 21:a.next=5;break;case 23:a.next=28;break;case 25:a.prev=25,a.t4=a.catch(3),s.e(a.t4);case 28:return a.prev=28,s.f(),a.finish(28);case 31:return a.t5=r,a.next=34,v(e,t);case 34:a.t6=a.sent,r=a.t5.concat.call(a.t5,a.t6);case 36:n(r);case 37:case"end":return a.stop()}}),a,null,[[3,25,28,31]])})));return function(e){return i.apply(this,arguments)}}())}))}function y(e){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)(o().mark((function e(t){var n,r,a,i,s,c,l,u,p,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.files.length){e.next=2;break}return e.abrupt("return",null);case 2:for(n=t.items,r={files:[]},a=1===n.length,i=[],s=0;s<n.length;s++)c=n[s],(l=c.webkitGetAsEntry())&&l.isDirectory?(a&&(r.dir=l.name),i.push({reader:l.createReader(),path:l.name})):l&&(a?r.file=c.getAsFile():r.files.push(c.getAsFile()));u=0,p=i;case 8:if(!(u<p.length)){e.next=17;break}return d=p[u],e.next=12,v(d.reader,d.path);case 12:f=e.sent,r.files=r.files.concat(f);case 14:u++,e.next=8;break;case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=l.memo((0,p.ZP)((function(e){var t=e.className,n=(0,d.O)(),i=(0,r.Z)(n,2),s=i[0],p=i[1],m=(0,l.useState)(null),h=m[0],g=m[1],v=function(){var t=(0,a.Z)(o().mark((function t(n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,y(n.dataTransfer);case 3:r=t.sent,console.info("fielInfo:",r),p(!1),r&&e.onDrop&&e.onDrop(r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,l.useEffect)((function(){var e=document.getElementById("__next");g(e)}),[]),(0,l.useEffect)((function(){if(h){var e=function(e){e.preventDefault(),p(!0)},t=function(e){"_drap_drop_frame"===e.target.id&&p(!1)};return h.addEventListener("dragenter",e),h.addEventListener("dragleave",t),function(){var n=document.getElementById("_drap_drop_frame");n&&h.removeChild(n),h.removeEventListener("dragenter",e),h.removeEventListener("dragleave",t)}}}),[h]),h?u.createPortal((0,f.jsx)("div",{id:"_drap_drop_frame",onDrop:v,onDragOver:function(e){return e.preventDefault()},className:c()(t,{show:s}),children:"Upload files to this directory"}),h):null})).withConfig({displayName:"OnDrapDropFrame",componentId:"sc-oxlf0c-0"})(["position:fixed;width:100vw;height:100vh;z-index:9999999;left:0;top:0;background:rgba(255,255,255,0.7);border:3px dashed #cccccc;box-sizing:border-box;display:none;align-items:center;justify-content:center;font-weight:600;font-size:36px;&.show{display:flex;}"]))},10363:function(e,t,n){n.d(t,{Z:function(){return J}});var r=n(16835),a=n(96486),i=n.n(a),o=n(67294),s=n(81960),c=n(79795),l=n(52256),u=n(35023),p=n(85905),d=n(54335),f=n(77572),m=n(56593),h=n(50029),g=n(82262),v=n(92777),y=n(59499),b=n(87794),x=n.n(b),w=n(81338),k=n(2593),j=n(35553),Z=JSON.parse('{"name":"StorageOrder","methods":[{"name":"create","args":[],"returns":{"type":"void"}},{"name":"bootstrap","args":[{"type":"pay","name":"seed"},{"type":"uint64","name":"base_price"},{"type":"uint64","name":"byte_price"},{"type":"uint64","name":"size_limit"},{"type":"uint64","name":"service_rate"},{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"set_base_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_byte_price","args":[{"type":"uint64","name":"price"}],"returns":{"type":"void"}},{"name":"set_size_limit","args":[{"type":"uint64","name":"size"}],"returns":{"type":"void"}},{"name":"set_service_rate","args":[{"type":"uint64","name":"rate"}],"returns":{"type":"void"}},{"name":"set_algo_cru_price","args":[{"type":"uint64","name":"algo_price"},{"type":"uint64","name":"cru_price"}],"returns":{"type":"void"}},{"name":"add_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"remove_order_node","args":[{"type":"address","name":"address"}],"returns":{"type":"void"}},{"name":"get_random_order_node","args":[],"returns":{"type":"address"}},{"name":"get_price","args":[{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"uint64"}},{"name":"place_order","args":[{"type":"pay","name":"seed"},{"type":"account","name":"merchant"},{"type":"string","name":"cid"},{"type":"uint64","name":"size"},{"type":"bool","name":"is_permanent"}],"returns":{"type":"void"}}],"networks":{},"desc":"This is storage order contract used to place order"}'),C=n(50205),_=n(47687),S=n(48764).Buffer;function I(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=new w.default.Algodv2(C.s3.token,C.s3.algodUrl),P=(0,g.Z)((function e(){(0,v.Z)(this,e),(0,y.Z)(this,"base_price",k.O$.from(0)),(0,y.Z)(this,"byte_price",k.O$.from(0)),(0,y.Z)(this,"service_rate",k.O$.from(0)),(0,y.Z)(this,"algo_price",k.O$.from(0)),(0,y.Z)(this,"cru_price",k.O$.from(0))}));function A(e,t){return F.apply(this,arguments)}function F(){return(F=(0,h.Z)(x().mark((function e(t,n){var r,a,i,o,s,c,l,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.getApplicationByID(C.s3.applicationId).do();case 2:r=e.sent,a=new P,i=new Set(Object.keys(a)),o=I(r.params["global-state"]);try{for(o.s();!(s=o.n()).done;)c=s.value,l=S.from(c.key,"base64").toString(),i.has(l)&&(a[l]=k.O$.from(c.value.uint))}catch(p){o.e(p)}finally{o.f()}return u=a.base_price.add(a.byte_price.mul(t).div(1024).div(1024)).mul(a.service_rate.add(100)).div(100).mul(a.cru_price).div(a.algo_price).div(k.O$.from("1".concat("0".repeat(12)))),e.abrupt("return",n?u.mul(200):u);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,n,r){return O.apply(this,arguments)}function O(){return(O=(0,h.Z)(x().mark((function e(t,n,r,a){var i,o,s,c,l,u,p,d,f,m,h,g,v,y,b;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.useWallet,o=D(i.wallet),e.next=4,E.getTransactionParams().do();case 4:return s=e.sent,c=new w.default.ABIContract(Z),e.next=8,A(r,a);case 8:return l=e.sent,e.next=11,E.accountInformation(i.account).do();case 11:if(u=e.sent,!k.O$.from(u.amount).lt(l)){e.next=14;break}throw"Insufficient Balance";case 14:return e.next=16,T();case 16:return p=e.sent,d=w.default.makePaymentTxnWithSuggestedParamsFromObject({from:i.account,to:C.s3.applicationAddress,amount:BigInt(l.toString()),suggestedParams:s}),f=new w.default.AtomicTransactionComposer,m={txn:d,signer:o},(h=[]).push({appIndex:C.s3.applicationId,name:w.default.decodeAddress(p).publicKey},{appIndex:C.s3.applicationId,name:new Uint8Array(S.from("nodes"))}),f.addMethodCall({appID:C.s3.applicationId,method:c.getMethodByName("place_order"),methodArgs:[m,p,n,r,a],sender:i.account,signer:o,boxes:h,suggestedParams:s}),e.next=25,f.execute(E,4);case 25:g=e.sent,v=I(g.methodResults),e.prev=27,v.s();case 29:if((y=v.n()).done){e.next=34;break}return b=y.value,e.abrupt("return",b.txID);case 32:e.next=29;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(27),v.e(e.t0);case 39:return e.prev=39,v.f(),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[27,36,39,42]])})))).apply(this,arguments)}function D(e){return function(){var t=(0,h.Z)(x().mark((function t(n,r){var a,o;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i().map(r,(function(e){return{txn:n[e]}})),t.next=3,e.signTransaction([a]);case 3:return o=t.sent,t.abrupt("return",Promise.resolve(o));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}function T(){return H.apply(this,arguments)}function H(){return(H=(0,h.Z)(x().mark((function e(){var t,n,r,a,i,o,s,c,l,u,p,d,f,m,h,g,v;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="node_num",e.next=3,E.getApplicationByID(C.s3.applicationId).do();case 3:n=e.sent,r=w.default.ABIType.from("string"),a=r.encode(t).slice(-t.length),i=S.from(a).toString("base64"),o=0,s=I(n.params["global-state"]),e.prev=9,s.s();case 11:if((c=s.n()).done){e.next=18;break}if((l=c.value).key!==i){e.next=16;break}return o=l.value.uint,e.abrupt("break",18);case 16:e.next=11;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),s.e(e.t0);case 23:return e.prev=23,s.f(),e.finish(23);case 26:if(0!==o){e.next=28;break}throw new Error("No merchant node for algorand user to order.");case 28:return u=Math.floor(Math.random()*o),p="nodes",d=r.encode(p).slice(-p.length),e.next=33,E.getApplicationBoxByName(C.s3.applicationId,d).do();case 33:return f=e.sent,m=w.default.ABIType.from("uint8[32][30]"),h=m.decode(f.value),g=h[u],v=new Uint8Array(g.map((function(e){return Number(e)}))),e.abrupt("return",w.default.encodeAddress(v));case 39:case"end":return e.stop()}}),e,null,[[9,20,23,26]])})))).apply(this,arguments)}var U=n(31031),B=n(56371);function M(){var e=(0,_.WY)();return(0,o.useMemo)((function(){var t,n;if(!(null===(t=e.useWallet)||void 0===t||!t.getProvider))return null===(n=e.useWallet)||void 0===n?void 0:n.getProvider()}),[e])}var W=n(64146);function R(e,t){var n=function(){var e,t=M();return null===t||void 0===t||null===(e=t.network)||void 0===e?void 0:e.chainId}(),r=function(){var e=M();return(0,o.useMemo)((function(){if(e){var t=C.XH[e.network.chainId];if(t)return W.lV.getContract(t,C.gE,e.getSigner())}}),[e])}(),i=(0,_.WY)(),s=i.wallet,c=i.useWallet,l=(0,o.useState)("-"),u=l[0],p=l[1],d=(0,o.useRef)("");(0,o.useEffect)((function(){var i=(0,a.uniqueId)();return d.current=i,p("-"),"metamask"===s&&r&&r.getPrice(k.O$.from(e),t).then((function(e){d.current==i&&p((0,B.formatEther)(e)+" "+(C.p$[n]||"ETH"))})).catch(console.error),function(){}}),[e,t,n,s]);var f=function(){var n=(0,h.Z)(x().mark((function n(a){var i,o,s,l,u,p,d,f;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=k.O$.from(e),n.next=3,r.getPrice(o,t);case 3:return s=n.sent,l=[a,o,t],n.next=7,c.getProvider().getBalance(c.account);case 7:if(!n.sent.lt(s)){n.next=10;break}throw"Insufficient Balance";case 10:return n.next=12,(i=r.estimateGas).placeOrder.apply(i,l.concat([{value:s}]));case 12:return u=n.sent,n.next=15,r.placeOrder.apply(r,l.concat([{value:s,gasLimit:u.mul(120).div(100)}]));case 15:return p=n.sent,n.next=18,p.wait();case 18:return d=n.sent,f=d.transactionHash,n.abrupt("return",f);case 21:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{pin:r?f:void 0,chainId:n,fee:u}}var $=n(88720),L=n(98255),G=n(19867),q=n(85893),V=d.ZP.div.withConfig({displayName:"UploadModal__Contribute",componentId:"sc-1ozqz35-0"})(["cursor:pointer;height:40px;line-height:40px;color:var(--primary-color);text-align:center;"]),Y=function(){};var J=o.memo((0,d.ZP)((function(e){var t=(0,_.WY)().wallet,n=e.className,d=e.uc,g=e.file,v=e.onClose,y=void 0===v?Y:v,b=e.onSuccess,w=void 0===b?Y:b,k=e.user,Z=e.type,S=e.isPremium,I="vault"===Z,N=(0,s.$G)().t,E=(0,U.T)(),P=E.endpoint,F=E.endpoints,O=E.onChangeEndpoint,D=(0,U.q)(),T=D.onChangePinner,H=D.pinner,B=D.pins,M=(0,f.O)(!0),W=(0,r.Z)(M,2),J=W[0],X=W[1],K=(0,o.useMemo)((function(){var e=g.file?g.file.size:g.files?i().sumBy(g.files,"size")+1024:0;return 0===e?e:e+Math.round(.2*e)}),[g]),Q="algorand"===t?function(e,t){var n=(0,_.WY)().wallet,r=(0,_.WY)(),i=(0,o.useState)("-"),s=i[0],c=i[1],l=(0,o.useRef)("");(0,o.useEffect)((function(){var r=(0,a.uniqueId)();return l.current=r,c("-"),"algorand"===n&&A(BigInt(e),t).then((function(e){l.current==r&&c(j.formatUnits(e.toString(),6)+" "+(C.p$[C.s3.chainId]||"ETH"))})).catch(console.error),function(){}}),[e,t,n]);var u=function(){var n=(0,h.Z)(x().mark((function n(a){return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,z(r,a,BigInt(e),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{pin:u,chainId:C.s3.chainId,fee:s}}(K,J):R(K,J),ee=Q.pin,te=Q.fee,ne=Q.chainId,re=!!ee,ae=I&&!!d.secret,ie=(0,$.V)(k,{isEncrypt:!!ae,secret:d.secret,file:g,isPremium:S,endpoint:P,pinner:H,pin:ee,chainId:ne}),oe=ie.error,se=ie.cancelUp,ce=ie.upState,le=ie.upload,ue=ie.isBusy,pe=ie.fileSizeError,de=(0,o.useCallback)((function(){se&&se.cancel(),y()}),[se,y]);console.log("filesize error",pe),console.log("isVault error",I),console.log("uc.secret",d.secret),console.log("user.account",k.account),console.log("!user.sign",!k.sign);var fe=pe||I&&!d.secret||!k.account||!k.sign;return(0,q.jsxs)(c.Z,{closeIcon:(0,q.jsx)("span",{className:"close icon cru-fo-x"}),onClose:de,open:!0,size:"large",className:n,children:[(0,q.jsx)(c.Z.Header,{className:"font-sans-semisold",children:N(g.dir?"Upload Folder":"Upload File")}),(0,q.jsxs)(c.Z.Content,{children:[(0,q.jsxs)(l.Z.Group,{children:[(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:g.dir?"Folder":"File"}),(0,q.jsx)(l.Z.Description,{content:g.dir?"".concat(g.dir," (").concat(g.files.length," files)"):"".concat(g.file.name," (").concat(g.file.size," bytes)")})]})}),(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsx)(G.Z,{fluid:!0,selection:!0,className:"clear-border",help:N("File streaming and wallet authentication will be processed by the chosen gateway."),disabled:ue,label:N("Select a free Web3 IPFS Gateway"),onChange:O,options:F,optionsMaxHeight:"240px",defaultGroup:P.group,defaultValue:P.value,footer:(0,q.jsx)(V,{onClick:function(){return window.open("https://wiki.crust.network/docs/en/buildIPFSWeb3AuthGW","_blank")},children:"Contribute IPFS W3Auth Gateway"})})}),re?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(l.Z,{fluid:!0,className:"encryption",children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:"Permanent storage"}),(0,q.jsx)(l.Z.Description,{style:{color:J?"transparent":void 0},content:J?"-":"Non-permanent storage, the guarantee period for the file is only 6 months."}),(0,q.jsx)(u.Z,{toggle:!0,defaultChecked:J,onChange:function(e,t){var n=t.checked;return X(n)}})]})}),(0,q.jsxs)("div",{style:{padding:"0 20px"},children:["Storage fee: ",te]})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(l.Z,{fluid:!0,children:(0,q.jsx)(G.Z,{fluid:!0,selection:!0,className:"clear-border",help:N("Your file will be pinned to IPFS for long-term storage."),disabled:0===B.length,label:N("Select a Web3 IPFS Pinner"),onChange:T,options:B,defaultValue:H.value,footer:(0,q.jsx)(V,{onClick:function(){return window.open("https://wiki.crust.network/docs/en/buildIPFSW3AuthPin","_blank")},children:"Contribute IPFS W3Auth Pinner"})})}),(0,q.jsx)(l.Z,{fluid:!0,className:"encryption",children:(0,q.jsxs)(l.Z.Content,{children:[(0,q.jsx)(l.Z.Header,{content:"File Encryption"}),d.secret?(0,q.jsx)(l.Z.Description,{content:ae?"Yes":"File encryption is disabled in Public Mode."}):(0,q.jsx)(l.Z.Description,{content:"Please go to the 'Setting' page and set encryption key before activating this function."}),(0,q.jsx)(u.Z,{toggle:!0,defaultChecked:ae,disabled:!0})]})})]})]}),oe&&(0,q.jsx)("div",{style:{color:"orangered",padding:"1rem",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:oe})]}),(0,q.jsx)(c.Z.Actions,{children:(0,q.jsxs)("div",{className:"uploading",children:[ce.up&&(0,q.jsx)(p.Z,{value:ce.progress,total:100,active:!0,color:"orange"}),ce.up&&(0,q.jsx)(L.Z,{onClick:de,children:N("Cancel")}),!ce.up&&(0,q.jsx)(L.Z,{fluid:!0,onClick:function(){fe||le().then((function(e){var t=(0,r.Z)(e,1)[0];return w(t),(0,m.H)({type:2,walletType:k.wallet,address:k.account,data:{cid:t.Hash,fileType:i().size(t.items)?1:0,strategy:t.Encrypted?1:0}})})).catch(console.error)},disabled:fe,children:N("Confirm")})]})})]})})).withConfig({displayName:"UploadModal",componentId:"sc-1ozqz35-1"})(['width:51.43rem !important;.header:nth-child(2){height:3.93rem;font-size:1.3rem !important;padding:0 1.14rem !important;font-weight:600 !important;line-height:3.93rem !important;}.close.icon{top:0.5rem;right:0.6rem;color:#666666;}.content{padding:1rem !important;}.ui.cards > .card{margin:0.5rem !important;.content > .header{font-size:1rem;font-weight:unset !important;color:var(--main-color);font-weight:600;font-family:OpenSans-SemiBold;}.content > .description{font-size:1rem;color:#999999;font-family:OpenSans-Regular;}}.ui.cards > .card:first-child{margin-top:1rem !important;}.toggle-options{cursor:pointer;font-size:10px;color:#999999;line-height:14px;margin-top:8px;margin-left:1.51rem;.cru-fo{font-size:14px;position:relative;top:2px;margin-left:6px;}}.actions{height:4.8rem;padding:0.5rem 1rem 0 1rem !important;border-top:unset !important;background:unset !important;.button{margin-left:unset !important;}}.uploading{height:4rem;display:flex;align-items:center;.progress{margin:0 1rem 0 0 !important;vertical-align:baseline;background:unset !important;border:1px solid orange;flex:1;.bar{min-width:unset !important;height:2.5rem;}}}.card.encryption{position:relative;.toggle{position:absolute;top:calc(50% - 0.75rem);right:1rem;input[type="radio"]:checked + label:before{background-color:#2ed158 !important;}}}']))},65572:function(e,t,n){n.d(t,{z:function(){return d}});var r=n(59499),a=n(16835),i=n(67294),o=n(58971),s=n.n(o),c=n(92080);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=[{text:"https://ipfs.io",value:"https://ipfs.io"},{text:"https://crustgateway.online",value:"https://crustgateway.online"},{text:"https://gw.w3ipfs.org.cn",value:"https://gw.w3ipfs.org.cn"}];function d(){var e=(0,i.useState)({gateway:"https://ipfs.io"}),t=e[0],n=e[1],r=(0,i.useState)(p),o=r[0],l=r[1];(0,i.useEffect)((function(){var e=s().get("downloadgateway");e&&n(e),s().get("allDownloadGateways"),o&&l(o)}),[]);var d=(0,i.useCallback)((function(e){var t={gateway:e};n(t),s().set("downloadgateway",t)}),[]),f=(0,c.X)((function(){return fetch("https://gist.githubusercontent.com/XueMoMo/2cfc982ce6aefb85e09313b714a029bd/raw/CrustFilesDownloadGateway.json").then((function(e){return e.json()})).then((function(e){return e.map((function(e){return{text:e,value:e}}))}))}),[]),m=(0,a.Z)(f,1)[0];return(0,i.useEffect)((function(){m&&m.length&&(s().set("allDownloadGateways",m),l(m))}),[m]),(0,i.useMemo)((function(){return u(u({},t),{},{set:d,allDownloadGateways:o})}),[t,d,o])}},61283:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(16835),a=n(67294),i=n(81960),o=n(90356);function s(){var e=(0,i.$G)().t,t=(0,a.useContext)(o.Il).alert,n=(0,a.useState)(void 0),s=n[0],c=n[1],l=(0,a.useRef)(null),u=(0,a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l.current&&(l.current.webkitdirectory=e,l.current.multiple=e,l.current.click())}),[l]),p=(0,a.useCallback)((function(){return u(!1)}),[u]),d=(0,a.useCallback)((function(){return u(!0)}),[u]),f=(0,a.useCallback)((function(n){var a=n.target.files;if(a)if(a.length>2e3)t.alert({title:e("Upload"),msg:e("Please do not upload more than 2000 files"),type:"error"});else if(0!==a.length){if(n.target.webkitdirectory){if(a.length>=1){for(var i=[],o=0;o<a.length;o++)i.push(a[o]);console.info(i);var s=i[0].webkitRelativePath.split("/"),l=(0,r.Z)(s,1)[0];c({files:i,dir:l})}}else c({file:a[0]});n.target.value=""}else t.alert({title:e("Upload"),msg:e("Please select non-empty folder"),type:"error"})}),[c,t,e]);return(0,a.useMemo)((function(){return{file:s,setFile:c,inputRef:l,_onClickUpFile:p,_onClickUpFolder:d,_onInputFile:f}}),[s,l,p,d,f])}},48218:function(e,t,n){n.d(t,{D:function(){return c}});var r=n(67294),a=n(96486),i=n.n(a),o=n(56755),s=n.n(o);function c(e){return(0,r.useMemo)((function(){var t=e.files.length,n=i().groupBy(e.files,(function(e){return e.Encrypted?"valut":"public"}));return n.public||(n.public=[]),n.valut||(n.valut=[]),{count:t,publicCount:i().size(n.public),valutCount:i().size(n.valut),publicSize:s()(i().sumBy(n.public,(function(e){return i().toNumber(e.Size)}))).toUpperCase(),valutSize:s()(i().sumBy(n.valut,(function(e){return i().toNumber(e.Size)}))).toUpperCase()}}),[e.files])}}}]);