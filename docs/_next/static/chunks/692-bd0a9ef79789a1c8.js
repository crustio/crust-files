"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[692],{10664:(e,t,n)=>{n.d(t,{M:()=>o});var r=n(3821),s=n(74638),a=n.n(s),i=n(12034);let c=[{text:"https://ipfs.io",value:"https://ipfs.io"},{text:"https://crustgateway.online",value:"https://crustgateway.online"},{text:"https://gw.w3ipfs.org.cn",value:"https://gw.w3ipfs.org.cn"}];function o(){let[e,t]=(0,r.useState)({gateway:"https://ipfs.io"}),[n,s]=(0,r.useState)(c);(0,r.useEffect)(()=>{let e=a().get("downloadgateway");e&&t(e),a().get("allDownloadGateways"),n&&s(n)},[]);let o=(0,r.useCallback)(e=>{let n={gateway:e};t(n),a().set("downloadgateway",n)},[]),[l]=(0,i.O)(()=>fetch("https://gist.githubusercontent.com/XueMoMo/2cfc982ce6aefb85e09313b714a029bd/raw/CrustFilesDownloadGateway.json").then(e=>e.json()).then(e=>e.map(e=>({text:e,value:e}))),[]);return(0,r.useEffect)(()=>{l&&l.length&&(a().set("allDownloadGateways",l),s(l))},[l]),(0,r.useMemo)(()=>({...e,set:o,allDownloadGateways:n}),[e,o,n])}},20692:(e,t,n)=>{n.d(t,{A:()=>L,i:()=>j});var r=n(29913),s=n(35648),a=n(91933),i=n.n(a),c=n(18077),o=n(36450),l=n.n(o),u=n(55982),p=n.n(u),d=n(3821),f=n(93572),m=n(59544),h=n(17468),y=n(23472),w=n(87080),g=n(35969),b=n(59061),x=n(73112),v=n(10664),A=n(87545),k=n(34133),C=n(41207),N=n(6271),E=n(31100),S=n(64881);let j=["https://crustipfs.live","https://crustipfs.art","https://crustipfs.info","https://web3files.world","https://web3files.live","https://storagefiles.site","https://storagefiles.space","https://crustipfs.tech"];function T(e,t,n){return"".concat(n,"/ipfs/").concat(e.Hash,"?filename=").concat(e.Name)}async function M(e,t){var n;let r=await (0,k.Y)(e.Hash,{name:e.Name,encrypted:null!=(n=e.Encrypted)&&n,gateway:e.UpEndpoint,fromAccount:t.account,fromWallet:t.wallet,from:t.nickName,isDir:!!e.items});return(0,A.z)({type:3,walletType:t.wallet,address:t.account,data:{cid:e.Hash,fileType:+!!e.items,strategy:+!!e.Encrypted,shareType:0}}),"".concat(window.location.origin,"/share?code=").concat(r)}function D(e){try{return JSON.parse(JSON.stringify(e))}catch(e){return{expired_at:0,reported_replica_count:0,amount:0,file_size:0,prepaid:!1}}}let L=d.memo((0,y.Ay)(function(e){var t,n,a,o;let{file:u,className:y,uc:A,onDelete:k,type:j="public"}=e,L=(0,x.i)(),{api:R,alert:F,loading:_}=(0,d.useContext)(w.BR),{endpoints:z}=(0,C.e)(),{gateway:G}=(0,v.M)(),H=(0,d.useCallback)(async()=>{if(u.Encrypted&&0===p().size(u.items))try{if(!A.secret)return;_.show();let e=T(u,z,G),t=await i().get(e,{responseType:"arraybuffer"});console.info("res::",t);let n=new Date().getTime(),r=await (0,g.I)(t.data,A.secret);if(console.info("decrypt:",(new Date().getTime()-n)/1e3),!r)throw"error";console.info("de:",r);let s=new File([r],u.Name,{type:t.headers["content-type"]});(0,c.saveAs)(s,u.Name),_.hide()}catch(e){_.hide(),F.error("Decrypt error")}else{let e=T(u,z,G);window.open(e,"_blank")}},[A,u,z,G]),I=(0,E.ZR)(),U=async()=>{try{let e=await M(u,I);window.open(e,"_blank")}catch(e){F.error((0,N.Yf)(e))}},q=async()=>{try{let e=await M(u,I),t=I.nickName?"Check out what '".concat(I.nickName,"' is sharing on Crust Files!"):"Check out what I am sharing on Crust Files!",n="https://twitter.com/intent/tweet?text=".concat(encodeURI(t),"&url=").concat(encodeURIComponent(e),"&hashtags=web3,ipfs,crustnetwork,metaverse,crustfiles");window.open(n,"_blank")}catch(e){F.error((0,N.Yf)(e))}},B=R&&(null==(t=R.query)?void 0:t.market)&&((0,s.T)(R.query.market.filesV2)?R.query.market.filesV2:R.query.market.files),K=R&&(null==(n=R.query)?void 0:n.market)&&R.query.market.files,O=!!B,P=(0,b.Gc)(B,[u.Hash]),V=(0,b.Gc)(K,[u.Hash]),J=(0,b.Gc)(null==R||null==(o=R.derive)||null==(a=o.chain)?void 0:a.bestNumber),Y=J&&J.toNumber(),Q=(0,d.useMemo)(()=>{let e={status:"Submitted"};if(V&&!V.isEmpty){let{expired_at:t,reported_replica_count:n,amount:r,file_size:s,prepaid:a}=D(V);e.expireTime=t,e.amount=r,e.startTime=t?t-216e3:0,e.fileSize=s,e.confirmedReplicas=n,e.prepaid=a,t&&Y&&t<Y&&(e.status="Expired"),n<1&&(e.status="Submitted"),t&&Y&&t>Y&&n>0&&(e.status="Success")}else if(P&&!P.isEmpty){let{expired_at:t,reported_replica_count:n,amount:r,file_size:s,prepaid:a}=D(P);e.expireTime=t,e.amount=r,e.startTime=t?t-216e3:0,e.fileSize=s,e.confirmedReplicas=n,e.prepaid=a,t&&Y&&t<Y&&(e.status="Expired"),n<1&&(e.status="Submitted"),t&&Y&&t>Y&&n>0&&(e.status="Success")}else O&&new Date().getTime()-u.PinTime>=72e5&&(e.status="Failed");return Y||(e.status="Loading"),e},[V,P,Y]);return(0,r.jsxs)(f.A.Row,{className:y,children:[(0,r.jsxs)(f.A.Cell,{className:"fileName",children:[(0,N.wh)(u.Name),u.items&&(0,r.jsx)("span",{className:"icon cru-fo-folder"}),u.Encrypted&&(0,r.jsx)(m.A,{trigger:(0,r.jsx)("span",{className:"icon cru-fo-key"}),content:"Encrypted",position:"top center"})]}),(0,r.jsxs)(f.A.Cell,{textAlign:"center",children:[(0,N.wh)(u.Hash),(0,r.jsx)(m.A,{position:"top center",content:"Copy File CID",trigger:(0,r.jsx)("span",{className:"cru-fo cru-fo-copy",onClick:()=>L(u.Hash),style:{marginLeft:"1.8rem"}})})]}),(0,r.jsx)(f.A.Cell,{textAlign:"center",style:{textTransform:"uppercase"},children:l()(Number(u.Size),{round:2})}),(0,r.jsxs)(f.A.Cell,{textAlign:"center",children:["Loading"===Q.status&&(0,r.jsx)(h.A,{loading:!0,name:"spinner"}),"Submitted"===Q.status&&Q.status,"Expired"===Q.status&&Q.status,"Failed"===Q.status&&Q.status,"Success"===Q.status&&"".concat(Q.status," (").concat(Q.confirmedReplicas," Replicas)")]}),(0,r.jsxs)(f.A.Cell,{textAlign:"center",children:[(0,r.jsx)(m.A,{position:"top center",content:"Open",trigger:(0,r.jsx)("span",{className:"cru-fo cru-fo-external-link",style:{marginLeft:"1rem"},onClick:H})}),(0,r.jsx)(m.A,{position:"top center",content:"Delete",trigger:(0,r.jsx)("span",{className:"cru-fo cru-fo-trash-2",style:{marginLeft:"1rem"},onClick:()=>{k(u)}})}),(0,r.jsx)(m.A,{position:"top center",content:"IPFS Scan",trigger:(0,r.jsx)("span",{className:"cru-fo cru-fo-search",style:{marginLeft:"1rem"},onClick:()=>{window.open("https://ipfs-scan.io?cid=".concat(u.Hash),"_blank")}})})]}),"public"===j&&(0,r.jsx)(f.A.Cell,{textAlign:"center",children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.A,{className:"item-share-btn",onClick:U,children:"Share"}),(0,r.jsx)(m.A,{position:"top center",content:"Quick Tweet",trigger:(0,r.jsx)("span",{className:"cru-fo cru-fo-twitter",onClick:q,style:{marginLeft:"0.5rem",top:"0.2rem"}})})]})})]})}).withConfig({componentId:"sc-1cb0b101-0"})(["color:var(--secend-color) !important;.cru-fo,.icon{cursor:pointer;font-size:1.3rem;position:relative;top:0.3rem;}.fileName{.icon{margin-left:0.6rem;}}.item-share-btn{padding:5px 11px !important;border-radius:8px !important;}td.center{text-align:center;}td.right{text-align:right;}"]))},35969:(e,t,n)=>{n.d(t,{I:()=>i,o:()=>a});let r=async e=>window.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),s=async(e,t,n)=>window.crypto.subtle.deriveKey(n,e,{name:"AES-GCM",length:256},!1,t),a=async(e,t)=>{try{let n=new Uint8Array(e),a=new TextEncoder().encode(t),i=window.crypto.getRandomValues(new Uint8Array(16)),c=window.crypto.getRandomValues(new Uint8Array(12)),o=await r(a),l=await s(o,["encrypt"],{name:"PBKDF2",salt:i,iterations:25e4,hash:"SHA-256"}),u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},l,n),p=new Uint8Array(u),d=new Uint8Array(p.byteLength+i.byteLength+c.byteLength);return d.set(i,0),d.set(c,i.byteLength),d.set(p,i.byteLength+c.byteLength),d}catch(e){throw console.error("Error encrypting file"),console.error(e),e}},i=async(e,t)=>{try{let n=new Uint8Array(e),a=new TextEncoder().encode(t),i=n.slice(0,16),c=n.slice(16,28),o=n.slice(28),l=await r(a),u=await s(l,["decrypt"],{name:"PBKDF2",salt:i,iterations:25e4,hash:"SHA-256"});return await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c},u,o)}catch(e){console.error("Error decrypting file"),console.error(e);return}}},41207:(e,t,n)=>{n.d(t,{N:()=>l,e:()=>o});var r=n(3821),s=n(18041),a=n(69221),i=n(74638),c=n.n(i);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"upload:last-gateway",{t:n}=(0,a.Bd)(),i=(0,r.useMemo)(()=>e&&e.length>0?e:(0,s.rt)(n).map(e=>{var t,n;return{...e,text:"".concat(null!=(t=e.text)?t:""," (").concat(null!=(n=e.location)?n:"",")")}}),[n,e]),o=(0,r.useMemo)(()=>{let e=c().get(t);if(e){let t=i.findIndex(t=>t.value===e.value);if(t>=0)return t}return 0},[t,i]),[l,u]=(0,r.useState)(i[o]),p=(0,r.useCallback)(e=>{u(n=>{let r="function"==typeof e?e(n):e;return c().set(t,{value:r.value}),r})},[]),d=(0,r.useCallback)((e,t)=>{let{value:n}=t,r=i.find(e=>e.value===n);r&&p(r)},[i,p]);return(0,r.useMemo)(()=>({endpoints:i,endpoint:l,setEndpoint:p,onChangeEndpoint:d}),[i,l,p,d])}function l(){let{t:e}=(0,a.Bd)(),t=(0,r.useMemo)(()=>(0,s.n3)(e).sort(()=>Math.random()>.5?-1:1).map(e=>{var t;return{...e,text:"".concat(null!=(t=e.text)?t:"Pinner")}}),[e]),[n,i]=(0,r.useState)(t[0]),c=(0,r.useCallback)((e,n)=>{let{value:r}=n,s=t.find(e=>e.value===r);s&&i(s)},[t]);return(0,r.useMemo)(()=>({pinner:n,pins:t,setPinner:i,onChangePinner:c}),[n,t,c])}},59061:(e,t,n)=>{n.d(t,{Gc:()=>o});var r=n(3821),s=n(34233),a=n(48480);function i(e){return e}function c(e){e.current.isActive=!1,e.current.subscriber&&(e.current.subscriber.then(e=>e()).catch(console.error),e.current.subscriber=null)}function o(e,t,n){let o=function(){let e=(0,r.useRef)(!1);return(0,r.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}(),l=(0,r.useRef)({isActive:!1,serialized:null,subscriber:null}),[u,p]=(0,r.useState)((n||{}).defaultValue);return(0,r.useEffect)(()=>()=>c(l),[]),(0,r.useEffect)(()=>{if(o.current&&e){let[r,u]=function(e,t){let{paramMap:n=i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return[JSON.stringify({f:null==e?void 0:e.name,p:t}),0!==t.length&&t.some(e=>(0,s.k)(e)||(0,a.b)(e))?null:n(t)]}(e,t||[],n);u&&r!==l.current.serialized&&(l.current.serialized=r,function(e,t,n,r,s){let{transform:o=i,withParams:l,withParamsTransform:u}=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},p=r.filter(e=>!(0,a.b)(e));c(t),setTimeout(()=>{if(e.current){var a;!n||n.meta&&(null==(a=n.meta.type)?void 0:a.isDoubleMap)&&2!==p.length?t.current.subscriber=null:(t.current.isActive=!0,t.current.subscriber=n(...r,n=>{e.current&&t.current.isActive&&e.current&&t.current.isActive&&s(l?[r,o(n)]:u?o([r,n]):o(n))}))}},0)}(o,l,e,u,p,n))}},[e,n,o,t]),u}},87545:(e,t,n)=>{n.d(t,{z:()=>i});var r=n(91933),s=n.n(r),a=n(34133);function i(e){return s().post((0,a.cO)("/common/report"),e).catch(console.error)}}}]);